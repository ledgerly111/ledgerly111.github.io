<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jannah - Premium Quran Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #D4AF37;
            --deep-gold: #B8941F;
            --light-gold: #F4E4BC;
            --pure-white: #FFFFFF;
            --soft-white: #FAFAFA;
            --text-dark: #2C3E50;
            --text-gray: #7F8C8D;
            --shadow-light: rgba(212, 175, 55, 0.1);
            --shadow-medium: rgba(212, 175, 55, 0.2);
            --shadow-dark: rgba(212, 175, 55, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--pure-white) 0%, var(--soft-white) 100%);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Premium Header */
        .header {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--deep-gold) 100%);
            padding: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100"><polygon fill="rgba(255,255,255,0.05)" points="0,0 1000,0 1000,80 0,100"/></svg>');
            pointer-events: none;
        }

        .header-content {
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .logo {
            font-size: 3rem;
            font-weight: 700;
            color: var(--pure-white);
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            letter-spacing: -1px;
        }

        .tagline {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.9);
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        /* Premium Navigation */
        .nav-container {
            background: var(--pure-white);
            border-radius: 20px;
            margin: -20px 20px 40px;
            padding: 20px;
            box-shadow: 0 20px 40px var(--shadow-medium);
            position: relative;
            z-index: 10;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: transparent;
            border: 2px solid var(--light-gold);
            color: var(--primary-gold);
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--primary-gold);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translate(-50%, -50%);
            z-index: -1;
        }

        .nav-tab:hover::before,
        .nav-tab.active::before {
            width: 100%;
            height: 100%;
        }

        .nav-tab:hover,
        .nav-tab.active {
            color: var(--pure-white);
            border-color: var(--primary-gold);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px var(--shadow-medium);
        }

        /* Content Sections */
        .content-section {
            display: none;
            min-height: 80vh;
        }

        .content-section.active {
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Premium Search Bar */
        .search-section {
            background: var(--pure-white);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px var(--shadow-light);
            border: 1px solid var(--light-gold);
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 20px 60px 20px 25px;
            border: 2px solid var(--light-gold);
            border-radius: 50px;
            font-size: 18px;
            font-weight: 400;
            outline: none;
            transition: all 0.3s ease;
            background: var(--soft-white);
        }

        .search-input:focus {
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 4px var(--shadow-light);
            background: var(--pure-white);
        }

        .search-icon {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-gold);
            font-size: 20px;
        }

        /* Premium Surah Grid */
        .surah-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .surah-card {
            background: var(--pure-white);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--light-gold);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .surah-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-gold), var(--deep-gold));
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .surah-card:hover::before {
            transform: scaleX(1);
        }

        .surah-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px var(--shadow-medium);
            border-color: var(--primary-gold);
        }

        .surah-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .surah-number {
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            color: var(--pure-white);
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .surah-names {
            flex: 1;
            margin-left: 20px;
        }

        .surah-name-arabic {
            font-family: 'Amiri', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
            text-align: right;
            direction: rtl;
        }

        .surah-name-english {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-gold);
            margin-bottom: 5px;
        }

        .surah-translation {
            font-size: 14px;
            color: var(--text-gray);
            font-style: italic;
        }

        .surah-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: var(--soft-white);
            border-radius: 12px;
            border-left: 4px solid var(--primary-gold);
        }

        .surah-meta {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-gray);
        }

        .meta-icon {
            color: var(--primary-gold);
            width: 16px;
        }

        .surah-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            color: var(--pure-white);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-dark);
        }

        .action-btn.secondary {
            background: var(--pure-white);
            color: var(--primary-gold);
            border: 2px solid var(--primary-gold);
        }

        /* Premium Verse Display */
        .verse-container {
            background: var(--pure-white);
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--light-gold);
            overflow: hidden;
        }

        .verse-header {
            background: linear-gradient(135deg, var(--light-gold), rgba(212, 175, 55, 0.1));
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .verse-number-badge {
            background: var(--primary-gold);
            color: var(--pure-white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .verse-controls {
            display: flex;
            gap: 10px;
        }

        .verse-control-btn {
            background: var(--pure-white);
            border: 2px solid var(--primary-gold);
            color: var(--primary-gold);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .verse-control-btn:hover {
            background: var(--primary-gold);
            color: var(--pure-white);
        }

        .verse-content {
            padding: 30px;
        }

        .verse-arabic {
            font-family: 'Amiri', serif;
            font-size: 32px;
            line-height: 2.2;
            color: var(--text-dark);
            text-align: right;
            direction: rtl;
            margin-bottom: 25px;
            padding: 20px;
            background: var(--soft-white);
            border-radius: 15px;
            border-right: 5px solid var(--primary-gold);
        }

        .verse-translation {
            font-size: 18px;
            line-height: 1.8;
            color: var(--text-gray);
            font-style: italic;
            padding: 20px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.02));
            border-radius: 15px;
            border-left: 5px solid var(--primary-gold);
        }

        /* Premium AI Chat */
        .nur-section {
            background: var(--pure-white);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px var(--shadow-light);
            border: 1px solid var(--light-gold);
        }

        .nur-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .nur-avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 15px 30px var(--shadow-dark);
            position: relative;
        }

        .nur-avatar::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, var(--primary-gold), transparent, var(--deep-gold));
            border-radius: 50%;
            z-index: -1;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .nur-icon {
            font-size: 40px;
            color: var(--pure-white);
        }

        .nur-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .nur-subtitle {
            font-size: 16px;
            color: var(--text-gray);
            font-weight: 400;
        }

        .chat-window {
            background: var(--soft-white);
            border-radius: 20px;
            height: 500px;
            overflow-y: auto;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid var(--light-gold);
            position: relative;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: messageSlide 0.4s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .user .message-avatar {
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            color: var(--pure-white);
        }

        .nur .message-avatar {
            background: linear-gradient(135deg, var(--text-dark), var(--text-gray));
            color: var(--pure-white);
        }

        .message-content {
            background: var(--pure-white);
            padding: 18px 22px;
            border-radius: 20px;
            max-width: 70%;
            box-shadow: 0 5px 15px var(--shadow-light);
            position: relative;
        }

        .user .message-content {
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            color: var(--pure-white);
        }

        .message-text {
            font-size: 16px;
            line-height: 1.6;
            margin: 0;
        }

        .chat-input-container {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: var(--pure-white);
            border-radius: 20px;
            border: 2px solid var(--light-gold);
        }

        .chat-input {
            flex: 1;
            padding: 18px 25px;
            border: none;
            border-radius: 25px;
            background: var(--soft-white);
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            background: var(--pure-white);
            box-shadow: 0 0 0 3px var(--shadow-light);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--primary-gold), var(--deep-gold));
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            color: var(--pure-white);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 25px var(--shadow-dark);
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--light-gold);
            border-top: 4px solid var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Audio Player */
        .audio-player {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
            background: var(--soft-white);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }

            .logo {
                font-size: 2.5rem;
            }

            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }

            .nav-tab {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }

            .surah-grid {
                grid-template-columns: 1fr;
            }

            .surah-card {
                padding: 25px;
            }

            .verse-arabic {
                font-size: 28px;
            }

            .message-content {
                max-width: 85%;
            }

            .chat-input-container {
                flex-direction: column;
            }

            .send-btn {
                align-self: flex-end;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--soft-white);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--deep-gold);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Premium Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">جنة Jannah</h1>
                <p class="tagline">Premium Quran Experience with AI Guidance</p>
            </div>
        </header>

        <!-- Navigation -->
        <div class="nav-container">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('surahs')">
                    <i class="fas fa-book-open"></i>
                    All Surahs
                </button>
                <button class="nav-tab" onclick="showSection('reader')">
                    <i class="fas fa-glasses"></i>
                    Quran Reader
                </button>
                <button class="nav-tab" onclick="showSection('audio')">
                    <i class="fas fa-play-circle"></i>
                    Audio Recitation
                </button>
                <button class="nav-tab" onclick="showSection('nur')">
                    <i class="fas fa-robot"></i>
                    Ask Nur AI
                </button>
            </div>
        </div>

        <!-- Surahs Section -->
        <div id="surahs" class="content-section active">
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search Surahs by name, number, or revelation place..." onkeyup="searchSurahs(this.value)">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>
            
            <div id="surah-grid" class="surah-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <h3>Loading All 114 Surahs...</h3>
                    <p>Connecting to Quran.com API</p>
                </div>
            </div>
        </div>

        <!-- Quran Reader Section -->
        <div id="reader" class="content-section">
            <div id="reader-header" style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: var(--primary-gold); margin-bottom: 10px;">Quran Reader</h2>
                <p style="color: var(--text-gray);">Select a Surah to start reading</p>
            </div>
            <div id="verses-container"></div>
        </div>

        <!-- Audio Recitation Section -->
        <div id="audio" class="content-section">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: var(--primary-gold); margin-bottom: 10px;">Audio Recitation</h2>
                <p style="color: var(--text-gray);">Listen to beautiful Quran recitation</p>
            </div>
            <div id="audio-player-container">
                <audio id="main-audio-player" class="audio-player" controls style="display: none;">
                    Your browser does not support audio playback.
                </audio>
            </div>
            <div id="current-recitation" style="text-align: center; margin: 20px 0;">
                <p style="color: var(--text-gray);">No recitation selected</p>
            </div>
        </div>

        <!-- Nur AI Section -->
        <div id="nur" class="content-section">
            <div class="nur-section">
                <div class="nur-header">
                    <div class="nur-avatar">
                        <i class="fas fa-star nur-icon"></i>
                    </div>
                    <h2 class="nur-title">Ask Nur - Your AI Guide</h2>
                    <p class="nur-subtitle">Get guidance on Quranic verses, Islamic teachings, and spiritual questions</p>
                </div>
                
                <div id="chat-window" class="chat-window">
                    <div class="message nur">
                        <div class="message-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <p class="message-text">السلام عليكم! I'm Nur, your AI companion for Islamic guidance. Ask me about any Surah, verse, or Islamic concept. How can I help you today?</p>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <input type="text" id="chat-input" class="chat-input" placeholder="Ask Nur about the Quran or Islamic guidance..." onkeypress="handleChatEnter(event)">
                    <button class="send-btn" onclick="sendChatMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration - Replace with your actual credentials
        const QURAN_API_CONFIG = {
            baseUrl: 'https://api.quran.com/api/v4',
            // Get these from https://quran.com/developers
            clientId: 'YOUR_QURAN_CLIENT_ID',
            accessToken: 'YOUR_QURAN_ACCESS_TOKEN'
        };

        const AQQAL_API_CONFIG = {
            // Add Aqqal.com API configuration when available
            baseUrl: 'https://api.aqqal.com', // Placeholder
            apiKey: 'YOUR_AQQAL_API_KEY'
        };

        // Global State
        let allSurahs = [];
        let currentAudio = null;
        let isLoadingApi = false;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadAllSurahs();
        });

        // Navigation Functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Load All Surahs from Quran.com API
        async function loadAllSurahs() {
            try {
                const response = await fetch(`${QURAN_API_CONFIG.baseUrl}/chapters`, {
                    headers: {
                        'x-client-id': QURAN_API_CONFIG.clientId,
                        'x-auth-token': QURAN_API_CONFIG.accessToken
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                allSurahs = data.chapters || [];
                displaySurahs(allSurahs);
            } catch (error) {
                console.error('Error loading Surahs:', error);
                displayErrorMessage();
            }
        }

        // Display Surahs in Premium Grid
        function displaySurahs(surahs) {
            const grid = document.getElementById('surah-grid');
            
            if (!surahs || surahs.length === 0) {
                grid.innerHTML = `
                    <div class="loading">
                        <h3>No Surahs found</h3>
                        <p>Please check your API configuration</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = '';
            
            surahs.forEach(surah => {
                const card = document.createElement('div');
                card.className = 'surah-card';
                
                card.innerHTML = `
                    <div class="surah-header">
                        <div class="surah-number">${surah.id}</div>
                        <div class="surah-names">
                            <div class="surah-name-arabic">${surah.name_arabic}</div>
                            <div class="surah-name-english">${surah.name_simple}</div>
                            <div class="surah-translation">${surah.translated_name?.name || 'The ' + surah.name_simple}</div>
                        </div>
                    </div>
                    
                    <div class="surah-info">
                        <div class="surah-meta">
                            <div class="meta-item">
                                <i class="fas fa-map-marker-alt meta-icon"></i>
                                <span>${surah.revelation_place === 'makkah' ? 'Mecca' : 'Medina'}</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-list-ol meta-icon"></i>
                                <span>${surah.verses_count} verses</span>
                            </div>
                            <div class="meta-item">
                                <i class="fas fa-bookmark meta-icon"></i>
                                <span>Pages ${surah.pages ? surah.pages[0] + '-' + surah.pages[1] : 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="surah-actions">
                        <button class="action-btn" onclick="readSurah(${surah.id}, '${surah.name_simple}')">
                            <i class="fas fa-book-reader"></i>
                            Read
                        </button>
                        <button class="action-btn secondary" onclick="listenSurah(${surah.id}, '${surah.name_simple}')">
                            <i class="fas fa-play"></i>
                            Listen
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Search Surahs
        function searchSurahs(query) {
            if (!query.trim()) {
                displaySurahs(allSurahs);
                return;
            }

            const filtered = allSurahs.filter(surah => 
                surah.name_simple.toLowerCase().includes(query.toLowerCase()) ||
                surah.name_arabic.includes(query) ||
                surah.translated_name?.name.toLowerCase().includes(query.toLowerCase()) ||
                surah.id.toString() === query ||
                surah.revelation_place.toLowerCase().includes(query.toLowerCase())
            );

            displaySurahs(filtered);
        }

        // Read Surah Function
        async function readSurah(surahId, surahName) {
            showSection('reader');
            document.querySelector('.nav-tab:nth-child(2)').classList.add('active');
            document.querySelector('.nav-tab:nth-child(1)').classList.remove('active');

            const readerHeader = document.getElementById('reader-header');
            const versesContainer = document.getElementById('verses-container');

            readerHeader.innerHTML = `
                <h2 style="color: var(--primary-gold); margin-bottom: 10px;">Reading: ${surahName}</h2>
                <p style="color: var(--text-gray);">Chapter ${surahId}</p>
            `;

            versesContainer.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <h3>Loading verses...</h3>
                </div>
            `;

            try {
                const response = await fetch(`${QURAN_API_CONFIG.baseUrl}/verses/by_chapter/${surahId}?words=true&translations=131&audio=1`, {
                    headers: {
                        'x-client-id': QURAN_API_CONFIG.clientId,
                        'x-auth-token': QURAN_API_CONFIG.accessToken
                    }
                });

                const data = await response.json();
                displayVerses(data.verses || []);
            } catch (error) {
                console.error('Error loading verses:', error);
                versesContainer.innerHTML = `
                    <div class="loading">
                        <h3>Error loading verses</h3>
                        <p>Please check your internet connection and API configuration</p>
                    </div>
                `;
            }
        }

        // Display Verses
        function displayVerses(verses) {
            const container = document.getElementById('verses-container');
            
            if (!verses || verses.length === 0) {
                container.innerHTML = `
                    <div class="loading">
                        <h3>No verses found</h3>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';

            verses.forEach(verse => {
                const verseDiv = document.createElement('div');
                verseDiv.className = 'verse-container';
                
                const translation = verse.translations && verse.translations[0] ? verse.translations[0].text : 'Translation not available';
                
                verseDiv.innerHTML = `
                    <div class="verse-header">
                        <div class="verse-number-badge">${verse.verse_number}</div>
                        <div class="verse-controls">
                            <button class="verse-control-btn" onclick="playVerseAudio('${verse.verse_key}')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="verse-control-btn" onclick="copyVerse('${verse.text_uthmani}', '${translation}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="verse-content">
                        <div class="verse-arabic">${verse.text_uthmani}</div>
                        <div class="verse-translation">${translation}</div>
                    </div>
                `;
                
                container.appendChild(verseDiv);
            });
        }

        // Listen to Surah Function
        function listenSurah(surahId, surahName) {
            showSection('audio');
            document.querySelector('.nav-tab:nth-child(3)').classList.add('active');
            document.querySelectorAll('.nav-tab').forEach((tab, index) => {
                if (index !== 2) tab.classList.remove('active');
            });

            const audioPlayer = document.getElementById('main-audio-player');
            const currentRecitation = document.getElementById('current-recitation');

            // Update UI
            currentRecitation.innerHTML = `
                <h3 style="color: var(--primary-gold);">Now Playing: ${surahName}</h3>
                <p style="color: var(--text-gray);">Chapter ${surahId}</p>
            `;

            // Set audio source (using popular reciter)
            const paddedId = surahId.toString().padStart(3, '0');
            const audioUrl = `https://download.quranicaudio.com/quran/abdurrahmaan_as-sudays/${paddedId}.mp3`;
            
            audioPlayer.src = audioUrl;
            audioPlayer.style.display = 'block';
            audioPlayer.load();
            
            audioPlayer.play().catch(error => {
                console.error('Audio playback failed:', error);
                currentRecitation.innerHTML = `
                    <p style="color: red;">Audio playback failed. Please try another recitation.</p>
                `;
            });
        }

        // Play individual verse audio
        function playVerseAudio(verseKey) {
            const audioUrl = `https://verses.quran.com/${verseKey.replace(':', '_')}.mp3`;
            
            if (currentAudio) {
                currentAudio.pause();
            }
            
            currentAudio = new Audio(audioUrl);
            currentAudio.play().catch(error => {
                console.error('Verse audio failed:', error);
                alert('Audio not available for this verse');
            });
        }

        // Copy verse function
        function copyVerse(arabic, translation) {
            const text = `${arabic}\n\n${translation}`;
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary feedback
                const notification = document.createElement('div');
                notification.textContent = 'Verse copied to clipboard!';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--primary-gold);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    z-index: 1000;
                    animation: fadeInOut 3s ease-in-out;
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            });
        }

        // AI Chat Functions
        function handleChatEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Add loading message
            const loadingId = addChatMessage('Nur is thinking...', 'nur', true);

            try {
                // Call AI API (Aqqal.com or fallback)
                const response = await callAIAPI(message);
                
                // Remove loading message
                document.getElementById(loadingId).remove();
                
                // Add AI response
                addChatMessage(response, 'nur');
            } catch (error) {
                console.error('AI API error:', error);
                document.getElementById(loadingId).remove();
                addChatMessage('I apologize, but I\'m having trouble connecting right now. Please try again later.', 'nur');
            }
        }

        function addChatMessage(message, sender, isLoading = false) {
            const chatWindow = document.getElementById('chat-window');
            const messageId = 'msg_' + Date.now();
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.id = messageId;
            
            const avatar = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <p class="message-text"${isLoading ? ' style="font-style: italic; opacity: 0.7;"' : ''}>${message}</p>
                </div>
            `;
            
            chatWindow.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            return messageId;
        }

        async function callAIAPI(message) {
            // Try Aqqal.com API first (when available)
            try {
                if (AQQAL_API_CONFIG.apiKey && AQQAL_API_CONFIG.apiKey !== 'YOUR_AQQAL_API_KEY') {
                    // Placeholder for Aqqal.com API call
                    const response = await fetch(`${AQQAL_API_CONFIG.baseUrl}/chat`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${AQQAL_API_CONFIG.apiKey}`
                        },
                        body: JSON.stringify({
                            message: message,
                            context: 'quran_guidance'
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        return data.response;
                    }
                }
            } catch (error) {
                console.log('Aqqal API not available, using fallback');
            }

            // Fallback to simulated responses
            return generateFallbackResponse(message);
        }

        function generateFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Islamic greetings
            if (lowerMessage.includes('salaam') || lowerMessage.includes('salam')) {
                return 'وعليكم السلام ورحمة الله وبركاته! Peace be upon you. How can I assist you with your Islamic studies today?';
            }
            
            // Prayer related
            if (lowerMessage.includes('prayer') || lowerMessage.includes('salah') || lowerMessage.includes('salat')) {
                return 'Prayer (Salah) is the second pillar of Islam and a direct connection with Allah. It\'s performed five times daily. Would you like to know about prayer times, the method of prayer, or verses about prayer from the Quran?';
            }
            
            // Specific Surahs
            if (lowerMessage.includes('fatiha') || lowerMessage.includes('fatihah')) {
                return 'Surah Al-Fatiha is the opening chapter of the Quran, known as "The Opening" and "Umm al-Kitab" (Mother of the Book). It\'s recited in every unit of prayer and contains 7 verses. It begins with "Bismillahir Rahmanir Raheem" and is a complete supplication.';
            }
            
            if (lowerMessage.includes('baqara') || lowerMessage.includes('baqarah')) {
                return 'Surah Al-Baqara is the longest chapter in the Quran with 286 verses. It contains many important teachings including the story of Adam, the Israelites, and the famous Ayat al-Kursi (Verse of the Throne).';
            }
            
            // General Quran questions
            if (lowerMessage.includes('quran') || lowerMessage.includes('quraan')) {
                return 'The Quran is the holy book of Islam, revealed to Prophet Muhammad (peace be upon him) over 23 years. It contains 114 chapters (Surahs) and 6,236 verses (Ayahs). How can I help you understand its teachings better?';
            }
            
            // Default response
            return 'Thank you for your question about Islamic teachings. The Quran and Sunnah provide guidance on all aspects of life. Could you be more specific about what you\'d like to learn? I\'m here to help with Quranic verses, Islamic concepts, or spiritual guidance.';
        }

        // Display error message
        function displayErrorMessage() {
            document.getElementById('surah-grid').innerHTML = `
                <div class="loading">
                    <h3>Unable to load Surahs</h3>
                    <p>Please ensure you have:</p>
                    <ul style="text-align: left; margin: 20px 0;">
                        <li>Valid Quran.com API credentials</li>
                        <li>Active internet connection</li>
                        <li>Correct API configuration</li>
                    </ul>
                    <p><strong>Get API access at:</strong> <a href="https://quran.com/developers" target="_blank" style="color: var(--primary-gold);">quran.com/developers</a></p>
                </div>
            `;
        }

        // Add custom styles for fade animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(-20px); }
                10%, 90% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
