<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ledgerly - Business Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'light-bg': '#f0f4f9', 'light-surface': '#ffffff', 'light-text': '#1f2937', 'light-text-secondary': '#6b7280',
                        'dark-bg': '#131314', 'dark-surface': '#1e1f20', 'dark-text': '#e3e3e3', 'dark-text-secondary': '#8f9397',
                        'primary': '#89b4fa', 'primary-hover': '#7287fd', 'accent-green': '#a6e3a1', 'accent-red': '#f38ba8',
                        'accent-yellow': '#f9e2af', 'accent-amber': '#fab387',
                    },
                    keyframes: {
                        'fade-in-out': { '0%': { opacity: '0', transform: 'translateY(-20px)' }, '10%': { opacity: '1', transform: 'translateY(0)' }, '90%': { opacity: '1', transform: 'translateY(0)' }, '100%': { opacity: '0', transform: 'translateY(-20px)' }, },
                        'color-pulse': { '0%, 100%': { color: '#89b4fa' }, '25%': { color: '#a6e3a1' }, '50%': { color: '#f5c2e7' }, '75%': { color: '#94e2d5' }, }
                    },
                    animation: { 'fade-in-out': 'fade-in-out 4s ease-in-out forwards', 'color-pulse': 'color-pulse 10s ease-in-out infinite', }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f0f4f9; color: #1f2937; font-family: 'Inter', sans-serif; }
        .dark body { background-color: #131314; color: #e3e3e3; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
        .tab-button.active { border-color: #89b4fa; color: #89b4fa; }
        .task-completed { text-decoration: line-through; color: #a3a3a3; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f0f4f9; }
        .dark ::-webkit-scrollbar-track { background: #1e1f20; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #4b5563; }
        @import url('https://rsms.me/inter/inter.css');
    </style>
</head>
<body class="antialiased font-sans">

    <div id="notification" class="fixed top-5 right-5 z-[100] text-black py-2 px-4 rounded-md shadow-lg opacity-0">
        <span id="notification-message"></span>
    </div>

    <div id="app" class="h-screen flex flex-col">
        <header id="main-header" class="bg-light-surface dark:bg-dark-surface p-4 flex justify-between items-center z-20 flex-shrink-0 border-b border-gray-200 dark:border-gray-700 hidden">
            <div class="flex items-center space-x-4">
                <button id="sidenav-toggle" class="md:hidden text-light-text-secondary dark:text-dark-text-secondary text-xl px-2 py-1" onclick="app.toggleSidenav()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="flex items-center space-x-2">
                    <i class="fas fa-book-open text-primary text-2xl"></i>
                    <h1 id="app-title" class="text-2xl font-bold text-light-text dark:text-dark-text animate-color-pulse hidden sm:block">Ledgerly</h1>
                </div>
            </div>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <span class="text-light-text-secondary dark:text-dark-text-secondary hidden md:inline">Current:</span>
                <select id="employee-switcher" class="bg-light-bg dark:bg-dark-bg text-light-text dark:text-dark-text border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm sm:text-base focus:ring-2 focus:ring-primary focus:outline-none"></select>
                 <button id="theme-toggle" class="text-light-text-secondary dark:text-dark-text-secondary text-xl px-2 py-1 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i id="theme-icon" class="fas"></i>
                </button>
            </div>
        </header>

        <main id="main-content" class="flex-grow md:flex overflow-hidden hidden">
            <div id="sidenav-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden" onclick="app.toggleSidenav()"></div>
            
            <div id="side-panel" class="fixed inset-y-0 left-0 z-40 w-4/5 max-w-sm bg-light-surface dark:bg-dark-surface p-4 overflow-y-auto transform -translate-x-full transition-transform duration-300 ease-in-out md:relative md:w-1/3 lg:w-1/4 md:translate-x-0 md:flex-shrink-0 md:border-r border-gray-200 dark:border-gray-700">
                <button onclick="app.toggleSidenav()" class="md:hidden absolute top-2 right-2 text-xl p-2 text-light-text-secondary dark:text-dark-text-secondary">&times;</button>
                <div id="company-overview-panel" class="mb-6 mt-8 md:mt-0">
                    <h2 class="text-xl font-semibold mb-3 text-light-text dark:text-dark-text flex items-center justify-between cursor-pointer" onclick="app.togglePanel('company-overview')">
                        <span><i class="fas fa-building mr-2 text-primary"></i>Company Overview</span>
                        <i id="company-overview-toggle-icon" class="fas fa-chevron-down"></i>
                    </h2>
                    <div id="company-overview-content" class="space-y-4 hidden">
                        <div id="company-stats" class="space-y-2 p-3 bg-light-bg dark:bg-dark-bg rounded-lg"></div>
                        <div>
                            <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary">Employees</h3><button class="bg-primary text-black px-3 py-1 rounded-md text-sm font-semibold hover:bg-primary-hover" onclick="app.openModal('addEmployeeModal')">+ Add</button></div>
                            <ul id="employee-list" class="space-y-2 text-sm"></ul>
                        </div>
                        <div id="inactive-employee-section" class="hidden">
                            <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary">Inactive Employees</h3></div>
                            <ul id="inactive-employee-list" class="space-y-2 text-sm"></ul>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary">Master Inventory</h3><div><button class="bg-primary text-black px-3 py-1 rounded-md text-sm font-semibold hover:bg-primary-hover mr-2" onclick="app.openModal('addProductModal')">+ Add</button><button class="bg-accent-green text-black px-3 py-1 rounded-md text-sm font-semibold hover:opacity-80" onclick="app.openModal('delegateStockModal')">Delegate</button></div></div>
                            <div id="master-inventory-list" class="space-y-1 text-sm"></div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary">Expense Categories</h3><button class="bg-primary text-black px-3 py-1 rounded-md text-sm font-semibold hover:bg-primary-hover" onclick="app.openModal('addCategoryModal')">+ Add</button></div>
                            <div id="expense-category-list" class="space-y-1 text-sm"></div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center mb-2"><h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary">All Tasks</h3><button class="bg-primary text-black px-3 py-1 rounded-md text-sm font-semibold hover:bg-primary-hover" onclick="app.openModal('createTaskModal')">+ Create</button></div>
                            <ul id="all-tasks-list" class="space-y-2 text-sm"></ul>
                        </div>
                    </div>
                </div>
                <div id="ai-advisor-panel">
                    <h2 class="text-xl font-semibold mb-3 text-light-text dark:text-dark-text flex items-center justify-between cursor-pointer" onclick="app.togglePanel('ai-advisor')">
                        <span><i class="fas fa-brain mr-2 text-primary"></i>Accura AI Advisor</span>
                        <i id="ai-advisor-toggle-icon" class="fas fa-chevron-down"></i>
                    </h2>
                    <div id="ai-advisor-content" class="space-y-4 hidden">
                        <div><label for="ai-employee-select" class="block text-sm font-medium text-light-text-secondary dark:text-dark-text-secondary mb-1">Select Employee</label><select id="ai-employee-select" class="w-full bg-light-bg dark:bg-dark-bg rounded-md p-2 focus:ring-2 focus:ring-primary focus:outline-none"></select></div>
                        <button id="generate-plan-btn" class="w-full bg-primary text-black py-2 rounded-md font-semibold hover:bg-primary-hover flex items-center justify-center" onclick="app.generateAIPlan()"><span id="generate-plan-text">Generate Plan</span><i id="generate-plan-loader" class="fas fa-spinner fa-spin hidden ml-2"></i></button>
                        <div id="ai-plan-output" class="mt-4 p-3 bg-light-bg dark:bg-dark-bg rounded-md text-sm prose max-w-none max-h-60 overflow-y-auto"><p class="text-light-text-secondary dark:text-dark-text-secondary">Plan will appear here.</p></div>
                    </div>
                </div>
            </div>
            
            <div id="employee-view" class="flex-grow p-2 md:p-6 overflow-y-auto w-full"></div>
        </main>
    </div>

    <div id="modal-container"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const app = {
        state: {
            theme: 'dark', currentEmployeeId: null, employees: [], stores: [],
            masterInventory: [], tasks: [], expenseCategories: [],
        },
        charts: {},
        pdfShiftApiKey: 'YOUR_PDFSHIFT_API_KEY',

        init() {
            this.loadState(); this.applyTheme(); this.renderModals();
            this.addEventListeners(); this.render();
            if(this.state.employees.length > 0) {
                this.togglePanel('company-overview', true); this.togglePanel('ai-advisor', true);
            }
        },

        showFirstTimeSetup() { document.getElementById('firstTimeModal')?.classList.remove('hidden'); },
        showMainApp() {
            document.getElementById('firstTimeModal')?.classList.add('hidden');
            document.getElementById('main-header').classList.remove('hidden');
            document.getElementById('main-content').classList.remove('hidden');
        },

        saveState() { localStorage.setItem('ledgerlyState', JSON.stringify(this.state)); },
        loadState() {
            const savedState = localStorage.getItem('ledgerlyState');
            if (savedState) this.state = { ...this.state, ...JSON.parse(savedState) };
            this.state.employees.forEach(emp => {
                if (emp.isActive === undefined) emp.isActive = true;
                if (!emp.transactions) emp.transactions = [];
                if (!emp.inventory) emp.inventory = [];
            });
            this.state.masterInventory.forEach(prod => { if (prod.isActive === undefined) prod.isActive = true; });
            if (!this.state.expenseCategories || this.state.expenseCategories.length === 0) {
                this.state.expenseCategories = [ { id: `cat_${Date.now()}_1`, name: 'Supplies' }, { id: `cat_${Date.now()}_2`, name: 'Travel' }, { id: `cat_${Date.now()}_3`, name: 'Utilities' }, { id: `cat_${Date.now()}_4`, name: 'Uncategorized' } ];
            }
             if (!this.state.tasks) this.state.tasks = [];
             if (!this.state.stores) this.state.stores = [];
        },
        getEmployee(id) { return this.state.employees.find(e => e.id === id); },
        getActiveEmployees() { return this.state.employees.filter(e => e.isActive); },
        getProduct(id) { return this.state.masterInventory.find(p => p.id === id); },
        getActiveProducts() { return this.state.masterInventory.filter(p => p.isActive); },
        getStore(id) { return this.state.stores.find(s => s.id === id); },
        getCategory(id) { return this.state.expenseCategories.find(c => c.id === id); },
        getTask(id) { return this.state.tasks.find(t => t.id === id); },

        addEventListeners() {
            document.getElementById('theme-toggle').addEventListener('click', () => this.toggleTheme());
            document.getElementById('first-employee-form')?.addEventListener('submit', e => this.handleFirstEmployee(e));
            document.getElementById('employee-switcher').addEventListener('change', e => this.handleEmployeeSwitch(e));
            document.getElementById('add-employee-form')?.addEventListener('submit', e => this.handleAddEmployee(e));
            document.getElementById('edit-employee-form')?.addEventListener('submit', e => this.handleUpdateEmployee(e));
            document.getElementById('add-product-form')?.addEventListener('submit', e => this.handleAddProduct(e));
            document.getElementById('edit-product-form')?.addEventListener('submit', e => this.handleUpdateProduct(e));
            document.getElementById('add-category-form')?.addEventListener('submit', e => this.handleAddCategory(e));
            document.getElementById('edit-category-form')?.addEventListener('submit', e => this.handleUpdateCategory(e));
            document.getElementById('delegate-stock-form')?.addEventListener('submit', e => this.handleDelegateStock(e));
            document.getElementById('create-task-form')?.addEventListener('submit', e => this.handleCreateTask(e));
        },

        attachEmployeeViewEventListeners() {
            document.getElementById('tabs-container')?.addEventListener('click', e => this.handleTabClick(e));
            document.getElementById('mobile-tabs')?.addEventListener('change', e => this.setActiveTab(e.target.value));
            const saleForm = document.getElementById('record-sale-form');
            if (saleForm) {
                saleForm.addEventListener('submit', e => this.handleRecordSale(e));
                saleForm.querySelector('#sale-type')?.addEventListener('change', () => this.handleSaleTypeChange());
                saleForm.querySelector('#sale-product')?.addEventListener('change', () => this.updateFinalSaleAmount());
                saleForm.querySelector('#sale-quantity')?.addEventListener('input', () => this.updateFinalSaleAmount());
                saleForm.querySelector('#sale-discount')?.addEventListener('input', () => this.updateFinalSaleAmount());
            }
            document.getElementById('record-expense-form')?.addEventListener('submit', e => this.handleRecordExpense(e));
            document.getElementById('employee-add-store-form')?.addEventListener('submit', e => this.handleAddStore(e));
            document.getElementById('edit-store-form')?.addEventListener('submit', e => this.handleUpdateStore(e));
            document.getElementById('invoice-form')?.addEventListener('submit', e => this.handleGenerateInvoice(e));
            document.getElementById('credit-received-form')?.addEventListener('submit', e => this.handleCreditReceived(e));
        },
        
        render() {
            try {
                if (this.state.employees.length === 0) { this.showFirstTimeSetup(); return; }
                this.showMainApp();
                if (!this.state.currentEmployeeId || !this.getEmployee(this.state.currentEmployeeId)?.isActive) {
                    const firstActive = this.getActiveEmployees()[0];
                    this.state.currentEmployeeId = firstActive ? firstActive.id : null;
                }
                this.renderEmployeeSwitcher();
                this.renderCompanyOverview();
                this.renderAIAdvisorPanel();
                const employeeView = document.getElementById('employee-view');
                if (this.getActiveEmployees().length === 0) {
                    employeeView.innerHTML = `<div class="p-8 text-center w-full h-full flex flex-col justify-center items-center"><h2 class="text-2xl font-bold mb-4">All Employees Inactive</h2><p>Please reactivate an employee.</p></div>`;
                } else if (this.state.currentEmployeeId) {
                    employeeView.innerHTML = this.getEmployeeViewTemplate();
                    this.renderTabs();
                    this.attachEmployeeViewEventListeners();
                    this.setActiveTab(document.querySelector('.tab-button.active')?.dataset.tab || 'dashboard');
                } else {
                    employeeView.innerHTML = `<div class="p-8 text-center w-full h-full flex flex-col justify-center items-center"><h2 class="text-2xl font-bold mb-4">No active employee selected.</h2><p>Please select an employee.</p></div>`;
                }
            } catch (error) {
                console.error("Render Error:", error);
                document.body.innerHTML = `<div style="padding: 2rem; font-family: sans-serif;"><h1>An Error Occurred</h1><p>The application could not start. Please check the console or try clearing local storage.</p><pre style="background: #eee; padding: 1rem; border-radius: 5px; white-space: pre-wrap;">${error.stack}</pre></div>`;
            }
        },

        getEmployeeViewTemplate() {
            const employee = this.getEmployee(this.state.currentEmployeeId);
            if (!employee) return '';
            const revenue = employee.transactions.filter(t => t.type === 'sale').reduce((sum, t) => sum + t.amount, 0);
            const expenses = employee.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const profit = revenue - expenses;

            return `
            <div class="w-full h-full flex flex-col">
                <div class="p-4 bg-light-surface dark:bg-dark-surface rounded-t-lg border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
                    <h2 class="text-2xl font-bold">${employee.name}</h2>
                    <p class="text-light-text-secondary dark:text-dark-text-secondary">${employee.position}</p>
                </div>

                <div class="border-b border-gray-200 dark:border-gray-700 px-4 flex-shrink-0">
                    <div class="md:hidden my-2">
                        <label for="mobile-tabs" class="sr-only">Select a tab</label>
                        <select id="mobile-tabs" class="form-input w-full"></select>
                    </div>
                    <nav id="tabs-container" class="-mb-px hidden md:flex space-x-6"></nav>
                </div>
                
                <div class="flex-grow p-4 overflow-y-auto">
                    <div id="dashboard-content" class="tab-content hidden">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow">
                                <div class="text-sm text-light-text-secondary dark:text-dark-text-secondary">Revenue</div>
                                <div class="text-2xl font-bold text-accent-green">$${revenue.toFixed(2)}</div>
                            </div>
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow">
                                <div class="text-sm text-light-text-secondary dark:text-dark-text-secondary">Expenses</div>
                                <div class="text-2xl font-bold text-accent-red">$${expenses.toFixed(2)}</div>
                            </div>
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow">
                                <div class="text-sm text-light-text-secondary dark:text-dark-text-secondary">Net Profit</div>
                                <div class="text-2xl font-bold ${profit >= 0 ? 'text-accent-green':'text-accent-red'}">$${profit.toFixed(2)}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow h-64 md:h-72"><canvas id="sales-over-time-chart"></canvas></div>
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow h-64 md:h-72"><canvas id="top-products-chart"></canvas></div>
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow h-64 md:h-72"><canvas id="expenses-by-category-chart"></canvas></div>
                            <div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow h-64 md:h-72"><canvas id="store-credit-chart"></canvas></div>
                        </div>
                    </div>
                    <div id="my-tasks-content" class="tab-content hidden"><h3 class="text-xl font-bold mb-4">My Tasks</h3><ul id="employee-tasks-list" class="space-y-3"></ul></div>
                    <div id="my-inventory-content" class="tab-content hidden"><h3 class="text-xl font-bold mb-4">My Inventory</h3><div class="overflow-x-auto bg-light-surface dark:bg-dark-surface rounded-lg shadow"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"><thead class="bg-light-bg dark:bg-dark-bg"><tr><th class="table-header">Product</th><th class="table-header">Stock</th></tr></thead><tbody id="employee-inventory-list" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody></table></div></div>
                    <div id="sales-expenses-content" class="tab-content hidden grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-cart-plus mr-3 text-accent-green"></i>Record a Sale</h3><form id="record-sale-form" class="space-y-4"><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="sale-product" class="form-label">Product</label><select id="sale-product" name="sale-product" class="form-input"></select></div><div><label for="sale-quantity" class="form-label">Quantity</label><input type="number" id="sale-quantity" name="sale-quantity" min="1" value="1" class="form-input"></div></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="sale-type" class="form-label">Sale Type</label><select id="sale-type" name="sale-type" class="form-input"></select></div><div><label for="sale-store" class="form-label">Store</label><select id="sale-store" name="sale-store" class="form-input"></select></div></div><div><label for="sale-discount" class="form-label">Discount ($)</label><input type="number" id="sale-discount" name="sale-discount" min="0" value="0" step="0.01" class="form-input"></div><div class="p-3 bg-light-bg dark:bg-dark-bg rounded-md text-right"><span class="text-light-text-secondary dark:text-dark-text-secondary">Final: </span><strong id="final-sale-amount" class="text-xl">$0.00</strong></div><button type="submit" class="w-full bg-primary text-black font-bold py-2 px-4 rounded-md hover:bg-primary-hover">Record Sale</button></form></div><div class="bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-money-bill-wave mr-3 text-accent-red"></i>Record an Expense</h3><form id="record-expense-form" class="space-y-4"><div><label for="expense-description" class="form-label">Description</label><input type="text" id="expense-description" name="expense-description" required class="form-input"></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="expense-amount" class="form-label">Amount ($)</label><input type="number" id="expense-amount" name="expense-amount" step="0.01" min="0" required class="form-input"></div><div><label for="expense-category" class="form-label">Category</label><select id="expense-category" name="expense-category" required class="form-input"></select></div></div><button type="submit" class="w-full bg-primary text-black font-bold py-2 px-4 rounded-md hover:bg-primary-hover">Record Expense</button></form></div></div>
                    <div id="stores-content" class="tab-content hidden"><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold mb-4">Add Store</h3><form id="employee-add-store-form" class="space-y-4"><div><label for="new-store-name" class="form-label">Store Name</label><input type="text" id="new-store-name" required class="form-input"></div><div><label for="new-store-location" class="form-label">Location</label><input type="text" id="new-store-location" required class="form-input"></div><div><label for="new-store-credit-limit" class="form-label">Credit Limit ($)</label><input type="number" id="new-store-credit-limit" required min="0" step="0.01" class="form-input"></div><button type="submit" class="w-full bg-primary text-black font-bold py-2 px-4 rounded-md hover:bg-primary-hover">Add Store</button></form></div><div class="lg:col-span-1 space-y-4" id="stores-list-container"><h3 class="text-xl font-bold">Existing Stores</h3><div id="stores-list" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2"></div></div></div></div>
                    <div id="invoices-content" class="tab-content hidden"><div class="max-w-xl mx-auto bg-light-surface dark:bg-dark-surface p-6 rounded-lg shadow-md"><h3 class="text-xl font-bold mb-4">Generate Invoice</h3><form id="invoice-form" class="space-y-4"><div><label for="invoice-store" class="form-label">Store</label><select id="invoice-store" class="form-input"></select></div><div class="grid grid-cols-2 gap-4"><div><label for="invoice-start-date" class="form-label">Start Date</label><input type="date" id="invoice-start-date" required class="form-input"></div><div><label for="invoice-end-date" class="form-label">End Date</label><input type="date" id="invoice-end-date" required class="form-input"></div></div><button type="submit" class="w-full bg-primary text-black font-bold py-2 px-4 rounded-md hover:bg-primary-hover">Generate PDF Invoice</button></form><p class="text-xs text-center mt-4 text-light-text-secondary dark:text-dark-text-secondary">Requires PDFShift API Key.</p></div></div>
                    <div id="ledger-content" class="tab-content hidden"><h3 class="text-xl font-bold mb-4">Transaction Ledger</h3><div class="overflow-x-auto bg-light-surface dark:bg-dark-surface rounded-lg shadow"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"><thead class="bg-light-bg dark:bg-dark-bg"><tr><th class="table-header">Date</th><th class="table-header">Type</th><th class="table-header">Details</th><th class="table-header text-right">Amount</th></tr></thead><tbody id="ledger-body" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody></table></div></div>
                </div>
            </div>`;
        },
        
        // --- The rest of the JS is unchanged. For brevity, it's collapsed here. ---
        // You can use the full JS block from the previous response.
        renderTabs() { const tabs = [ { id: 'dashboard', name: 'Dashboard', icon: 'fa-chart-line' }, { id: 'my-tasks', name: 'My Tasks', icon: 'fa-tasks' }, { id: 'my-inventory', name: 'My Inventory', icon: 'fa-boxes' }, { id: 'sales-expenses', name: 'Sales & Expenses', icon: 'fa-exchange-alt' }, { id: 'stores', name: 'Manage Stores', icon: 'fa-store' }, { id: 'invoices', name: 'Invoices', icon: 'fa-file-invoice-dollar' }, { id: 'ledger', name: 'Ledger', icon: 'fa-history' } ]; document.getElementById('tabs-container').innerHTML = tabs.map(tab => `<button data-tab="${tab.id}" class="tab-button text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text dark:hover:text-dark-text border-b-2 border-transparent py-3 px-4 font-medium text-sm"><i class="fas ${tab.icon} mr-2 hidden md:inline"></i>${tab.name}</button>`).join(''); document.getElementById('mobile-tabs').innerHTML = tabs.map(tab => `<option value="${tab.id}">${tab.name}</option>`).join(''); },
        toggleSidenav() { document.getElementById('side-panel').classList.toggle('-translate-x-full'); document.getElementById('sidenav-backdrop').classList.toggle('hidden'); },
        setActiveTab(tabName) { document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden')); document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active')); document.getElementById(`${tabName}-content`)?.classList.remove('hidden'); document.querySelector(`[data-tab="${tabName}"]`)?.classList.add('active'); const mobileTabs = document.getElementById('mobile-tabs'); if (mobileTabs) mobileTabs.value = tabName; const renderMap = { dashboard: 'renderDashboard', 'my-tasks': 'renderMyTasks', 'my-inventory': 'renderMyInventory', 'sales-expenses': 'renderSalesAndExpenses', stores: 'renderStoresTab', invoices: 'renderInvoices', ledger: 'renderLedger' }; if (renderMap[tabName]) this[renderMap[tabName]](); },
        togglePanel(panelName, forceOpen = false) { const icon = document.getElementById(`${panelName}-toggle-icon`); const content = document.getElementById(`${panelName}-content`); const isHidden = content.classList.contains('hidden'); if (forceOpen && isHidden) { content.classList.remove('hidden'); } else if (!forceOpen) { content.classList.toggle('hidden'); } icon.classList.toggle('fa-chevron-up', !content.classList.contains('hidden')); icon.classList.toggle('fa-chevron-down', content.classList.contains('hidden')); },
        renderCompanyOverview() { let totalRevenue=0,totalExpenses=0;this.state.employees.forEach(emp=>{if(emp.isActive&&emp.transactions){totalRevenue+=emp.transactions.filter(t=>t.type==='sale').reduce((sum,t)=>sum+t.amount,0);totalExpenses+=emp.transactions.filter(t=>t.type==='expense').reduce((sum,t)=>sum+t.amount,0)}});const totalProfit=totalRevenue-totalExpenses;document.getElementById('company-stats').innerHTML=`<h3 class="font-bold text-light-text-secondary dark:text-dark-text-secondary text-base">Firm-Wide Totals (Active)</h3><div class="text-sm space-y-1"><div class="flex justify-between"><span>Revenue:</span> <span class="font-semibold text-accent-green">$${totalRevenue.toFixed(2)}</span></div><div class="flex justify-between"><span>Expenses:</span> <span class="font-semibold text-accent-red">$${totalExpenses.toFixed(2)}</span></div><div class="flex justify-between border-t border-gray-300 dark:border-gray-600 pt-1 mt-1"><span>Net Profit:</span> <span class="font-bold text-lg ${totalProfit<0?'text-accent-red':'text-accent-green'}">$${totalProfit.toFixed(2)}</span></div></div>`;document.getElementById('employee-list').innerHTML=this.getActiveEmployees().map(emp=>{const revenue=emp.transactions.filter(t=>t.type==='sale').reduce((sum,t)=>sum+t.amount,0);const expenses=emp.transactions.filter(t=>t.type==='expense').reduce((sum,t)=>sum+t.amount,0);return`<li class="bg-light-bg dark:bg-dark-bg p-2 rounded"><div class="flex justify-between items-center"><div><span class="font-bold">${emp.name}</span><em class="text-xs ml-1 text-light-text-secondary dark:text-dark-text-secondary">(${emp.position})</em></div><div class="flex space-x-3"><button class="text-sm hover:text-primary" onclick="app.startEditEmployee('${emp.id}')"><i class="fas fa-pencil-alt"></i></button><button class="text-sm hover:text-accent-red" onclick="app.deactivateEmployee('${emp.id}')"><i class="fas fa-user-slash"></i></button></div></div><div class="text-xs mt-2 space-y-1 pl-1 border-l-2 border-gray-200 dark:border-gray-600 ml-1 pl-2"><div class="flex justify-between"><span>Revenue:</span> <span class="font-semibold text-accent-green">$${revenue.toFixed(2)}</span></div><div class="flex justify-between"><span>Expenses:</span> <span class="font-semibold text-accent-red">$${expenses.toFixed(2)}</span></div></div></li>`}).join('')||`<p class="text-sm text-light-text-secondary dark:text-dark-text-secondary">No active employees yet.</p>`;const inactiveEmployees=this.state.employees.filter(e=>!e.isActive);document.getElementById('inactive-employee-section').classList.toggle('hidden',inactiveEmployees.length===0);document.getElementById('inactive-employee-list').innerHTML=inactiveEmployees.map(emp=>`<li class="flex justify-between items-center bg-light-bg dark:bg-dark-bg p-2 rounded opacity-60"><span class="italic">${emp.name}</span><button class="text-sm text-accent-green hover:opacity-80 font-semibold" onclick="app.reactivateEmployee('${emp.id}')">Reactivate</button></li>`).join('');document.getElementById('master-inventory-list').innerHTML=this.getActiveProducts().map(prod=>`<div class="bg-light-bg dark:bg-dark-bg p-2 rounded"><div class="flex justify-between items-center"><span>${prod.name}</span><div class="flex items-center"><span class="font-mono text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded mr-3">${prod.stock}</span><button class="text-sm hover:text-primary" onclick="app.startEditProduct('${prod.id}')"><i class="fas fa-pencil-alt"></i></button><button class="text-sm hover:text-accent-red ml-2" onclick="app.deleteProduct('${prod.id}')"><i class="fas fa-trash-alt"></i></button></div></div></div>`).join('')||`<p class="text-sm text-light-text-secondary dark:text-dark-text-secondary">No active products.</p>`;document.getElementById('expense-category-list').innerHTML=this.state.expenseCategories.map(cat=>`<div class="flex justify-between items-center bg-light-bg dark:bg-dark-bg p-2 rounded"><span>${cat.name}</span><div><button class="text-sm hover:text-primary" onclick="app.startEditCategory('${cat.id}')"><i class="fas fa-pencil-alt"></i></button><button class="text-sm hover:text-accent-red ml-2" onclick="app.deleteCategory('${cat.id}')"><i class="fas fa-trash-alt"></i></button></div></div>`).join('')||`<p class="text-sm text-light-text-secondary dark:text-dark-text-secondary">No categories defined.</p>`;document.getElementById('all-tasks-list').innerHTML=this.state.tasks.map(task=>`<li class="bg-light-bg dark:bg-dark-bg p-2 rounded ${task.status==='Completed'?'task-completed':''}"><p>${task.description}</p><small class="text-light-text-secondary dark:text-dark-text-secondary">To: ${this.getEmployee(task.assigneeId)?.name||'Unassigned'}</small></li>`).join('')||`<p class="text-sm text-light-text-secondary dark:text-dark-text-secondary">No tasks created.</p>`; },
        renderDashboard() { const employee=this.getEmployee(this.state.currentEmployeeId);if(!employee)return;const isDark=this.state.theme==='dark';const gridColor=isDark?'rgba(255, 255, 255, 0.1)':'rgba(0, 0, 0, 0.1)';const textColor=isDark?'#e3e3e3':'#1f2937';Object.values(this.charts).forEach(chart=>{if(chart)chart.destroy()});const salesByDate=employee.transactions.filter(t=>t.type==='sale').reduce((acc,t)=>{const date=t.date.split('T')[0];acc[date]=(acc[date]||0)+t.amount;return acc},{});const sortedDates=Object.keys(salesByDate).sort();this.charts.sales=new Chart(document.getElementById('sales-over-time-chart').getContext('2d'),{type:'line',data:{labels:sortedDates,datasets:[{label:'Daily Revenue',data:sortedDates.map(date=>salesByDate[date]),borderColor:'#89b4fa',backgroundColor:'rgba(137, 180, 250, 0.2)',tension:0.1,fill:true}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,grid:{color:gridColor},ticks:{color:textColor}},x:{grid:{color:gridColor},ticks:{color:textColor}}},plugins:{legend:{labels:{color:textColor}}}}});const salesByProduct=employee.transactions.filter(t=>t.type==='sale').reduce((acc,t)=>{acc[t.productId]=(acc[t.productId]||0)+t.amount;return acc},{});const topProducts=Object.entries(salesByProduct).sort(([,a],[,b])=>b-a).slice(0,5);this.charts.products=new Chart(document.getElementById('top-products-chart').getContext('2d'),{type:'bar',data:{labels:topProducts.map(([productId])=>this.getProduct(productId)?.name||'Unknown'),datasets:[{label:'Revenue by Product',data:topProducts.map(([,amount])=>amount),backgroundColor:['#89b4fa','#a6e3a1','#f9e2af','#fab387','#f38ba8']}]},options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',scales:{x:{beginAtZero:true,grid:{color:gridColor},ticks:{color:textColor}},y:{grid:{color:gridColor},ticks:{color:textColor}}},plugins:{legend:{display:false},title:{display:true,text:'Top Products by Revenue',color:textColor,font:{size:16}}}}});const expensesByCategory=employee.transactions.filter(t=>t.type==='expense').reduce((acc,t)=>{const category=this.getCategory(t.categoryId)||{name:'Uncategorized'};acc[category.name]=(acc[category.name]||0)+t.amount;return acc},{});this.charts.expensesByCategory=new Chart(document.getElementById('expenses-by-category-chart').getContext('2d'),{type:'doughnut',data:{labels:Object.keys(expensesByCategory),datasets:[{data:Object.values(expensesByCategory),backgroundColor:['#f38ba8','#fab387','#f9e2af','#a6e3a1','#89b4fa','#cba6f7','#f5c2e7'],borderColor:isDark?'#1e1f20':'#ffffff',borderWidth:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{color:textColor}},title:{display:true,text:'Expenses by Category',color:textColor,font:{size:16}}}}});const totalCreditUsed=this.state.stores.reduce((sum,s)=>sum+(s.creditUsed||0),0);const totalCreditAvailable=this.state.stores.reduce((sum,s)=>sum+(s.creditAvailable||0),0);const outstandingCredit=totalCreditUsed-this.state.stores.reduce((sum,s)=>sum+(s.creditPaidBack||0),0);const totalCreditLimit=totalCreditAvailable+totalCreditUsed;this.charts.credit=new Chart(document.getElementById('store-credit-chart').getContext('2d'),{type:'bar',data:{labels:['Credit Status'],datasets:[{label:'Outstanding',data:[outstandingCredit],backgroundColor:'#f38ba8'},{label:'Available',data:[totalCreditLimit-outstandingCredit],backgroundColor:'#a6e3a1'}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true,max:totalCreditLimit>0?totalCreditLimit:1},y:{stacked:true}},plugins:{title:{display:true,text:'Overall Credit Status',color:textColor,font:{size:16}},legend:{position:'top',labels:{color:textColor}}}}})},
        renderMyTasks() { const employeeTasks=this.state.tasks.filter(t=>t.assigneeId===this.state.currentEmployeeId);document.getElementById('employee-tasks-list').innerHTML=employeeTasks.map(task=>`<li class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow flex justify-between items-center ${task.status==='Completed'?'task-completed opacity-60':''}"><span>${task.description}</span><button class="text-black px-3 py-1 rounded-md text-sm font-semibold ${task.status==='Completed'?'bg-gray-400':'bg-accent-green hover:opacity-80'}" onclick="app.toggleTaskStatus('${task.id}')">${task.status==='Completed'?'Reopen':'Complete'}</button></li>`).join('')||`<p class="text-center py-8 text-light-text-secondary dark:text-dark-text-secondary">You have no assigned tasks.</p>`; },
        renderMyInventory() { const employee=this.getEmployee(this.state.currentEmployeeId);const listEl=document.getElementById('employee-inventory-list');if(!employee||!employee.inventory||employee.inventory.filter(i=>i.stock>0).length===0){listEl.innerHTML=`<tr><td colspan="2" class="px-6 py-4 text-center text-light-text-secondary dark:text-dark-text-secondary">No inventory delegated to you.</td></tr>`;return}listEl.innerHTML=employee.inventory.filter(i=>i.stock>0).map(item=>{const product=this.getProduct(item.productId);return`<tr class="hover:bg-light-bg dark:hover:bg-dark-bg"><td class="px-6 py-4 whitespace-nowrap">${product?product.name:'Unknown Product'}</td><td class="px-6 py-4 whitespace-nowrap font-mono">${item.stock}</td></tr>`}).join('')},
        renderSalesAndExpenses() { const employee=this.getEmployee(this.state.currentEmployeeId);document.getElementById('sale-type').innerHTML=`<option value="Cash">Cash</option><option value="Credit">Credit</option><option value="Deal">Deal</option>`;document.getElementById('sale-store').innerHTML=this.state.stores.map(s=>`<option value="${s.id}">${s.name}</option>`).join('')||`<option disabled>Add a store first</option>`;const availableInventory=employee?.inventory?.filter(item=>item.stock>0&&this.getProduct(item.productId)?.isActive)||[];document.getElementById('sale-product').innerHTML=availableInventory.map(item=>{const product=this.getProduct(item.productId);return`<option value="${product.id}">${product.name} (Stock: ${item.stock})</option>`}).join('')||`<option disabled>No inventory to sell</option>`;document.querySelector('#record-sale-form button').disabled=!(this.state.stores.length>0&&availableInventory.length>0);this.updateFinalSaleAmount();document.getElementById('expense-category').innerHTML=this.state.expenseCategories.map(c=>`<option value="${c.id}">${c.name}</option>`).join('')||`<option disabled>Add a category first</option>`;document.querySelector('#record-expense-form button').disabled=this.state.expenseCategories.length===0},
        renderStoresTab() { const storesList=document.getElementById('stores-list');storesList.innerHTML=this.state.stores.map(store=>{const outstandingCredit=(store.creditUsed||0)-(store.creditPaidBack||0);return`<div class="bg-light-surface dark:bg-dark-surface p-4 rounded-lg shadow"><div class="flex justify-between items-start"><div><h4 class="font-bold text-lg">${store.name}</h4><p class="text-sm text-light-text-secondary dark:text-dark-text-secondary">${store.location}</p></div><div class="flex space-x-3"><button onclick="app.startReceiveCredit('${store.id}')" class="text-sm text-accent-green hover:opacity-80" title="Receive Credit Payment"><i class="fas fa-hand-holding-usd"></i></button><button onclick="app.startEditStore('${store.id}')" class="text-sm hover:text-primary" title="Edit Store"><i class="fas fa-pencil-alt"></i></button><button onclick="app.deleteStore('${store.id}')" class="text-sm hover:text-accent-red" title="Delete Store"><i class="fas fa-trash-alt"></i></button></div></div><div class="mt-4 text-xs space-y-2"><div class="flex justify-between"><span>Credit Limit:</span> <span class="font-mono">$${(store.creditAvailable+store.creditUsed).toFixed(2)}</span></div><div class="flex justify-between"><span>Outstanding Credit:</span> <span class="font-mono ${outstandingCredit>0?'text-accent-red':''}">$${outstandingCredit.toFixed(2)}</span></div><div class="flex justify-between"><span>Paid Back:</span> <span class="font-mono text-accent-green">$${(store.creditPaidBack||0).toFixed(2)}</span></div></div></div>`}).join('')||`<p class="text-center py-8 text-light-text-secondary dark:text-dark-text-secondary">No stores added yet.</p>`},
        renderInvoices() { const invoiceStoreSelect=document.getElementById('invoice-store');invoiceStoreSelect.innerHTML=this.state.stores.map(s=>`<option value="${s.id}">${s.name}</option>`).join('')||`<option disabled>No stores available</option>`},
        renderLedger() { const employee=this.getEmployee(this.state.currentEmployeeId);const ledgerBody=document.getElementById('ledger-body');if(!employee||!ledgerBody)return;const sortedTransactions=[...employee.transactions].sort((a,b)=>new Date(b.date)-new Date(a.date));ledgerBody.innerHTML=sortedTransactions.map(t=>{const date=new Date(t.date).toLocaleDateString();const time=new Date(t.date).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});if(t.type==='sale'){const product=this.getProduct(t.productId);const store=this.getStore(t.storeId);return`<tr class="hover:bg-light-bg dark:hover:bg-dark-bg"><td class="px-4 py-3">${date} ${time}</td><td class="px-4 py-3"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-accent-green/20 text-accent-green">Sale</span></td><td class="px-4 py-3">Sold ${t.quantity} x ${product?.name||'N/A'} to ${store?.name||'N/A'}</td><td class="px-4 py-3 text-right font-mono text-accent-green">+${t.amount.toFixed(2)}</td></tr>`}else if(t.type==='expense'){const category=this.getCategory(t.categoryId);return`<tr class="hover:bg-light-bg dark:hover:bg-dark-bg"><td class="px-4 py-3">${date} ${time}</td><td class="px-4 py-3"><span class="px-2 py-1 text-xs font-semibold rounded-full bg-accent-red/20 text-accent-red">Expense</span></td><td class="px-4 py-3">${t.description} <span class="text-light-text-secondary dark:text-dark-text-secondary">(${category?.name||'Uncategorized'})</span></td><td class="px-4 py-3 text-right font-mono text-accent-red">-${t.amount.toFixed(2)}</td></tr>`}return''}).join('')||`<tr><td colspan="4" class="text-center py-10 text-light-text-secondary dark:text-dark-text-secondary">No transactions recorded yet.</td></tr>`},
        renderModals() { document.getElementById('modal-container').innerHTML=`${this.getFirstTimeModalHTML()}${this.getGenericModalHTML('addEmployeeModal','Add New Employee',`<form id="add-employee-form" class="space-y-4"><div><label for="new-employee-name" class="block text-sm font-medium">Name</label><input type="text" id="new-employee-name" required class="modal-input"></div><div><label for="new-employee-position" class="block text-sm font-medium">Position</label><input type="text" id="new-employee-position" required class="modal-input"></div><button type="submit" class="modal-submit-button">Add Employee</button></form>`)}${this.getGenericModalHTML('editEmployeeModal','Edit Employee',`<form id="edit-employee-form" class="space-y-4"><input type="hidden" id="edit-employee-id"><div><label for="edit-employee-name" class="block text-sm font-medium">Name</label><input type="text" id="edit-employee-name" required class="modal-input"></div><div><label for="edit-employee-position" class="block text-sm font-medium">Position</label><input type="text" id="edit-employee-position" required class="modal-input"></div><button type="submit" class="modal-submit-button">Save Changes</button></form>`)}${this.getGenericModalHTML('addProductModal','Add New Product',`<form id="add-product-form" class="space-y-4"><div><label for="new-product-name" class="block text-sm font-medium">Product Name</label><input type="text" id="new-product-name" required class="modal-input"></div><div><label for="new-product-price" class="block text-sm font-medium">Price ($)</label><input type="number" id="new-product-price" step="0.01" min="0" required class="modal-input"></div><div><label for="new-product-stock" class="block text-sm font-medium">Initial Stock</label><input type="number" id="new-product-stock" min="0" required class="modal-input"></div><button type="submit" class="modal-submit-button">Add Product</button></form>`)}${this.getGenericModalHTML('editProductModal','Edit Product',`<form id="edit-product-form" class="space-y-4"><input type="hidden" id="edit-product-id"><div><label for="edit-product-name" class="block text-sm font-medium">Product Name</label><input type="text" id="edit-product-name" required class="modal-input"></div><div><label for="edit-product-price" class="block text-sm font-medium">Price ($)</label><input type="number" id="edit-product-price" step="0.01" min="0" required class="modal-input"></div><div><label for="edit-product-stock" class="block text-sm font-medium">Current Stock</label><input type="number" id="edit-product-stock" min="0" required class="modal-input"></div><button type="submit" class="modal-submit-button">Save Changes</button></form>`)}${this.getGenericModalHTML('addCategoryModal','Add Expense Category',`<form id="add-category-form" class="space-y-4"><div><label for="new-category-name" class="block text-sm font-medium">Category Name</label><input type="text" id="new-category-name" required class="modal-input"></div><button type="submit" class="modal-submit-button">Add Category</button></form>`)}${this.getGenericModalHTML('editCategoryModal','Edit Expense Category',`<form id="edit-category-form" class="space-y-4"><input type="hidden" id="edit-category-id"><div><label for="edit-category-name" class="block text-sm font-medium">Category Name</label><input type="text" id="edit-category-name" required class="modal-input"></div><button type="submit" class="modal-submit-button">Save Changes</button></form>`)}${this.getGenericModalHTML('delegateStockModal','Delegate Stock to Employee',`<form id="delegate-stock-form" class="space-y-4"><div><label for="delegate-employee" class="block text-sm font-medium">Employee</label><select id="delegate-employee" class="modal-input"></select></div><div><label for="delegate-product" class="block text-sm font-medium">Product</label><select id="delegate-product" class="modal-input"></select></div><div><label for="delegate-quantity" class="block text-sm font-medium">Quantity</label><input type="number" id="delegate-quantity" min="1" required class="modal-input"></div><button type="submit" class="modal-submit-button">Delegate Stock</button></form>`)}${this.getGenericModalHTML('createTaskModal','Create a New Task',`<form id="create-task-form" class="space-y-4"><div><label for="task-description" class="block text-sm font-medium">Task Description</label><input type="text" id="task-description" required class="modal-input"></div><div><label for="task-assignee" class="block text-sm font-medium">Assign To</label><select id="task-assignee" class="modal-input"></select></div><button type="submit" class="modal-submit-button">Create Task</button></form>`)}${this.getGenericModalHTML('editStoreModal','Edit Store',`<form id="edit-store-form" class="space-y-4"><input type="hidden" id="edit-store-id"><div><label for="edit-store-name" class="block text-sm font-medium">Store Name</label><input type="text" id="edit-store-name" required class="modal-input"></div><div><label for="edit-store-location" class="block text-sm font-medium">Location</label><input type="text" id="edit-store-location" required class="modal-input"></div><div><label for="edit-store-credit-limit" class="block text-sm font-medium">Credit Limit</label><input type="number" step="0.01" min="0" id="edit-store-credit-limit" required class="modal-input"></div><button type="submit" class="modal-submit-button">Save Changes</button></form>`)}${this.getGenericModalHTML('creditReceivedModal','Receive Credit Payment',`<form id="credit-received-form" class="space-y-4"><input type="hidden" id="credit-store-id"><p>Receiving payment from: <strong id="credit-store-name"></strong></p><p>Outstanding credit: <strong id="credit-outstanding"></strong></p><div><label for="credit-received-amount" class="block text-sm font-medium">Amount Received</label><input type="number" id="credit-received-amount" step="0.01" min="0" required class="modal-input"></div><button type="submit" class="modal-submit-button">Record Payment</button></form>`)}`},
        getGenericModalHTML(id,title,content){return`<div id="${id}" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop"><div class="bg-light-surface dark:bg-dark-surface rounded-lg shadow-xl w-full max-w-md mx-auto transform transition-all"><div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700"><h3 class="text-xl font-semibold">${title}</h3><button onclick="app.closeModal('${id}')" class="text-light-text-secondary dark:text-dark-text-secondary hover:text-light-text dark:hover:text-dark-text">&times;</button></div><div class="p-6">${content}</div></div></div>`},
        getFirstTimeModalHTML(){return`<div id="firstTimeModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden modal-backdrop"><div class="bg-light-surface dark:bg-dark-surface rounded-lg shadow-xl w-full max-w-md mx-auto text-center p-8"><i class="fas fa-rocket text-4xl text-primary mb-4"></i><h2 class="text-2xl font-bold mb-2">Welcome to Ledgerly!</h2><p class="text-light-text-secondary dark:text-dark-text-secondary mb-6">Let's get you set up. Start by adding your first employee.</p><form id="first-employee-form" class="space-y-4"><div><label for="first-employee-name" class="sr-only">Name</label><input type="text" id="first-employee-name" placeholder="First Employee's Name" required class="modal-input"></div><div><label for="first-employee-position" class="sr-only">Position</label><input type="text" id="first-employee-position" placeholder="Position (e.g., Manager)" required class="modal-input"></div><button type="submit" class="modal-submit-button w-full">Get Started</button></form></div></div>`},
        renderEmployeeSwitcher() { const switcher=document.getElementById('employee-switcher');switcher.innerHTML=this.getActiveEmployees().map(emp=>`<option value="${emp.id}" ${emp.id===this.state.currentEmployeeId?'selected':''}>${emp.name}</option>`).join('')},
        renderAIAdvisorPanel() { const selector=document.getElementById('ai-employee-select');selector.innerHTML=this.getActiveEmployees().map(emp=>`<option value="${emp.id}">${emp.name}</option>`).join('');if(this.state.currentEmployeeId){selector.value=this.state.currentEmployeeId}},
        applyTheme() { const isDark=this.state.theme==='dark';document.documentElement.classList.toggle('dark',isDark);document.getElementById('theme-icon').className=`fas ${isDark?'fa-sun':'fa-moon'}`},
        toggleTheme() { this.state.theme=this.state.theme==='dark'?'light':'dark';this.applyTheme();this.saveState();if(document.getElementById('dashboard-content')?.classList.contains('hidden')===false){this.renderDashboard()}},
        openModal(modalId) {if(modalId==='delegateStockModal'){document.getElementById('delegate-employee').innerHTML=this.getActiveEmployees().map(e=>`<option value="${e.id}">${e.name}</option>`).join('');document.getElementById('delegate-product').innerHTML=this.getActiveProducts().filter(p=>p.stock>0).map(p=>`<option value="${p.id}">${p.name} (Master Stock: ${p.stock})</option>`).join('')}if(modalId==='createTaskModal'){document.getElementById('task-assignee').innerHTML=this.getActiveEmployees().map(e=>`<option value="${e.id}">${e.name}</option>`).join('')}document.getElementById(modalId)?.classList.remove('hidden')},
        closeModal(modalId){document.getElementById(modalId)?.classList.add('hidden')},
        showNotification(message,type='success'){const notification=document.getElementById('notification');const notificationMessage=document.getElementById('notification-message');notificationMessage.textContent=message;notification.className='fixed top-5 right-5 z-[100] text-black py-2 px-4 rounded-md shadow-lg';if(type==='success'){notification.classList.add('bg-accent-green')}else{notification.classList.add('bg-accent-red')}notification.classList.add('animate-fade-in-out');setTimeout(()=>{notification.classList.remove('animate-fade-in-out')},4000)},
        handleTabClick(e){if(e.target.closest('.tab-button')){this.setActiveTab(e.target.closest('.tab-button').dataset.tab)}},
        handleSaleTypeChange(){const saleType=document.getElementById('sale-type').value;const discountField=document.getElementById('sale-discount');if(saleType==='Deal'){discountField.value=0;discountField.disabled=true}else{discountField.disabled=false}this.updateFinalSaleAmount()},
        updateFinalSaleAmount(){const productSelect=document.getElementById('sale-product');const quantity=parseInt(document.getElementById('sale-quantity').value)||0;let discount=parseFloat(document.getElementById('sale-discount').value)||0;const product=this.getProduct(productSelect.value);if(!product||quantity<=0){document.getElementById('final-sale-amount').textContent='$0.00';return}if(document.getElementById('sale-type').value==='Deal'){discount=0}const total=(product.price*quantity)-discount;document.getElementById('final-sale-amount').textContent=`$${total.toFixed(2)}`},
        createEmployee(name,position){return{id:`emp_${Date.now()}`,name,position,isActive:true,inventory:[],transactions:[]}},
        handleFirstEmployee(e){e.preventDefault();const name=document.getElementById('first-employee-name').value;const position=document.getElementById('first-employee-position').value;if(!name.trim()||!position.trim())return;const firstEmployee=this.createEmployee(name,position);this.state.employees.push(firstEmployee);this.state.currentEmployeeId=firstEmployee.id;this.saveState();this.render();this.showMainApp();this.togglePanel('company-overview',true);this.togglePanel('ai-advisor',true)},
        handleAddEmployee(e){e.preventDefault();const name=document.getElementById('new-employee-name').value;const position=document.getElementById('new-employee-position').value;if(!name.trim()||!position.trim())return;this.state.employees.push(this.createEmployee(name,position));this.saveState();this.render();this.closeModal('addEmployeeModal');this.showNotification('Employee added successfully!');e.target.reset()},
        startEditEmployee(id){const employee=this.getEmployee(id);if(!employee)return;document.getElementById('edit-employee-id').value=id;document.getElementById('edit-employee-name').value=employee.name;document.getElementById('edit-employee-position').value=employee.position;this.openModal('editEmployeeModal')},
        handleUpdateEmployee(e){e.preventDefault();const id=document.getElementById('edit-employee-id').value;const employee=this.getEmployee(id);if(!employee)return;employee.name=document.getElementById('edit-employee-name').value;employee.position=document.getElementById('edit-employee-position').value;this.saveState();this.render();this.closeModal('editEmployeeModal');this.showNotification('Employee updated!')},
        deactivateEmployee(id){if(confirm('Are you sure you want to deactivate this employee? They will not be able to log sales or expenses.')){const employee=this.getEmployee(id);if(employee){employee.isActive=false;this.saveState();this.render();this.showNotification('Employee deactivated.','error')}}},
        reactivateEmployee(id){const employee=this.getEmployee(id);if(employee){employee.isActive=true;this.saveState();this.render();this.showNotification('Employee reactivated.')}},
        handleEmployeeSwitch(e){this.state.currentEmployeeId=e.target.value;this.saveState();this.render()},
        handleAddStore(e){e.preventDefault();const name=document.getElementById('new-store-name').value;const location=document.getElementById('new-store-location').value;const creditLimit=parseFloat(document.getElementById('new-store-credit-limit').value);if(!name.trim()||isNaN(creditLimit)){this.showNotification('Please fill all fields correctly.','error');return}this.state.stores.push({id:`store_${Date.now()}`,name,location,creditAvailable:creditLimit,creditUsed:0,creditPaidBack:0});this.saveState();this.render();this.showNotification('Store added successfully!');e.target.reset()},
        startEditStore(id){const store=this.getStore(id);if(!store)return;document.getElementById('edit-store-id').value=id;document.getElementById('edit-store-name').value=store.name;document.getElementById('edit-store-location').value=store.location;document.getElementById('edit-store-credit-limit').value=store.creditAvailable+store.creditUsed;this.openModal('editStoreModal')},
        handleUpdateStore(e){e.preventDefault();const id=document.getElementById('edit-store-id').value;const store=this.getStore(id);if(!store)return;const newCreditLimit=parseFloat(document.getElementById('edit-store-credit-limit').value);if(isNaN(newCreditLimit)||newCreditLimit<store.creditUsed){this.showNotification('New credit limit cannot be less than credit already used.','error');return}store.name=document.getElementById('edit-store-name').value;store.location=document.getElementById('edit-store-location').value;store.creditAvailable=newCreditLimit-store.creditUsed;this.saveState();this.render();this.closeModal('editStoreModal');this.showNotification('Store updated!')},
        deleteStore(id){if(confirm('Are you sure you want to delete this store? This action cannot be undone.')){this.state.stores=this.state.stores.filter(s=>s.id!==id);this.saveState();this.render();this.showNotification('Store deleted.','error')}},
        startReceiveCredit(id){const store=this.getStore(id);if(!store)return;const outstanding=(store.creditUsed||0)-(store.creditPaidBack||0);if(outstanding<=0){this.showNotification('This store has no outstanding credit.','success');return}document.getElementById('credit-store-id').value=id;document.getElementById('credit-store-name').textContent=store.name;document.getElementById('credit-outstanding').textContent=`$${outstanding.toFixed(2)}`;document.getElementById('credit-received-amount').max=outstanding;document.getElementById('credit-received-amount').value=outstanding;this.openModal('creditReceivedModal')},
        handleCreditReceived(e){e.preventDefault();const id=document.getElementById('credit-store-id').value;const store=this.getStore(id);if(!store)return;const amount=parseFloat(document.getElementById('credit-received-amount').value);const outstanding=(store.creditUsed||0)-(store.creditPaidBack||0);if(isNaN(amount)||amount<=0||amount>outstanding){this.showNotification('Invalid payment amount.','error');return}store.creditPaidBack=(store.creditPaidBack||0)+amount;store.creditAvailable+=amount;this.saveState();this.render();this.closeModal('creditReceivedModal');this.showNotification('Credit payment recorded!')},
        handleAddProduct(e){e.preventDefault();const name=document.getElementById('new-product-name').value;const price=parseFloat(document.getElementById('new-product-price').value);const stock=parseInt(document.getElementById('new-product-stock').value);if(!name.trim()||isNaN(price)||isNaN(stock))return;this.state.masterInventory.push({id:`prod_${Date.now()}`,name,price,stock,isActive:true});this.saveState();this.render();this.closeModal('addProductModal');this.showNotification('Product added to master inventory!');e.target.reset()},
        startEditProduct(id){const product=this.getProduct(id);if(!product)return;document.getElementById('edit-product-id').value=id;document.getElementById('edit-product-name').value=product.name;document.getElementById('edit-product-price').value=product.price;document.getElementById('edit-product-stock').value=product.stock;this.openModal('editProductModal')},
        handleUpdateProduct(e){e.preventDefault();const id=document.getElementById('edit-product-id').value;const product=this.getProduct(id);if(!product)return;product.name=document.getElementById('edit-product-name').value;product.price=parseFloat(document.getElementById('edit-product-price').value);product.stock=parseInt(document.getElementById('edit-product-stock').value);this.saveState();this.render();this.closeModal('editProductModal');this.showNotification('Product updated!')},
        deleteProduct(id){if(confirm('Are you sure you want to delete this product? It will become unavailable for new sales.')){const product=this.getProduct(id);if(product){product.isActive=false;this.saveState();this.render();this.showNotification('Product deleted.','error')}}},
        handleAddCategory(e){e.preventDefault();const name=document.getElementById('new-category-name').value;if(!name.trim())return;this.state.expenseCategories.push({id:`cat_${Date.now()}`,name});this.saveState();this.render();this.closeModal('addCategoryModal');this.showNotification('Category added!');e.target.reset()},
        startEditCategory(id){const category=this.getCategory(id);if(!category)return;document.getElementById('edit-category-id').value=id;document.getElementById('edit-category-name').value=category.name;this.openModal('editCategoryModal')},
        handleUpdateCategory(e){e.preventDefault();const id=document.getElementById('edit-category-id').value;const category=this.getCategory(id);if(!category)return;category.name=document.getElementById('edit-category-name').value;this.saveState();this.render();this.closeModal('editCategoryModal');this.showNotification('Category updated!')},
        deleteCategory(id){if(this.state.expenseCategories.length<=1){this.showNotification('Cannot delete the last category.','error');return}if(confirm('Are you sure? Existing expenses under this category will become uncategorized.')){const uncategorized=this.state.expenseCategories.find(c=>c.name.toLowerCase()==='uncategorized')||this.state.expenseCategories[0];this.state.employees.forEach(emp=>{emp.transactions.forEach(t=>{if(t.type==='expense'&&t.categoryId===id){t.categoryId=uncategorized.id}})});this.state.expenseCategories=this.state.expenseCategories.filter(c=>c.id!==id);this.saveState();this.render();this.showNotification('Category deleted.','error')}},
        handleDelegateStock(e){e.preventDefault();const employeeId=document.getElementById('delegate-employee').value;const productId=document.getElementById('delegate-product').value;const quantity=parseInt(document.getElementById('delegate-quantity').value);const employee=this.getEmployee(employeeId);const product=this.getProduct(productId);if(!employee||!product||isNaN(quantity)||quantity<=0){this.showNotification('Invalid delegation details.','error');return}if(product.stock<quantity){this.showNotification('Not enough stock in master inventory.','error');return}product.stock-=quantity;let employeeProduct=employee.inventory.find(p=>p.productId===productId);if(employeeProduct){employeeProduct.stock+=quantity}else{employee.inventory.push({productId:productId,stock:quantity})}this.saveState();this.render();this.closeModal('delegateStockModal');this.showNotification(`Delegated ${quantity} of ${product.name} to ${employee.name}.`)},
        handleCreateTask(e){e.preventDefault();const description=document.getElementById('task-description').value;const assigneeId=document.getElementById('task-assignee').value;if(!description.trim()||!assigneeId)return;this.state.tasks.push({id:`task_${Date.now()}`,description,assigneeId,status:'Pending'});this.saveState();this.render();this.closeModal('createTaskModal');this.showNotification('Task created successfully!');e.target.reset()},
        toggleTaskStatus(id){const task=this.getTask(id);if(task){task.status=task.status==='Completed'?'Pending':'Completed';this.saveState();this.render()}},
        handleRecordSale(e){e.preventDefault();const form=e.target;const employee=this.getEmployee(this.state.currentEmployeeId);const productId=form.elements['sale-product'].value;const quantity=parseInt(form.elements['sale-quantity'].value);const saleType=form.elements['sale-type'].value;const storeId=form.elements['sale-store'].value;const discount=parseFloat(form.elements['sale-discount'].value)||0;const product=this.getProduct(productId);const employeeInventoryItem=employee.inventory.find(i=>i.productId===productId);const store=this.getStore(storeId);if(!product||!employeeInventoryItem||!store||isNaN(quantity)||quantity<=0){this.showNotification('Please fill all fields correctly.','error');return}if(employeeInventoryItem.stock<quantity){this.showNotification(`Not enough stock. Only ${employeeInventoryItem.stock} available.`,'error');return}let finalAmount=product.price*quantity;if(saleType!=='Deal'){finalAmount-=discount}if(saleType==='Credit'){const outstandingCredit=(store.creditUsed||0)-(store.creditPaidBack||0);if(outstandingCredit+finalAmount>store.creditAvailable+store.creditUsed){this.showNotification('This sale exceeds the store\'s credit limit.','error');return}store.creditUsed+=finalAmount;store.creditAvailable-=finalAmount}else if(saleType==='Deal'){const masterProduct=this.getProduct(productId);if(masterProduct.stock<quantity){this.showNotification(`Not enough stock in Master Inventory for a deal sale. Only ${masterProduct.stock} available.`,'error');return}masterProduct.stock-=quantity}else{employeeInventoryItem.stock-=quantity}employee.transactions.push({id:`txn_${Date.now()}`,type:'sale',productId,quantity,saleType,storeId,discount,amount:finalAmount,date:new Date().toISOString()});this.saveState();this.render();this.showNotification('Sale recorded successfully!');form.reset();this.updateFinalSaleAmount()},
        handleRecordExpense(e){e.preventDefault();const form=e.target;const employee=this.getEmployee(this.state.currentEmployeeId);if(!employee)return;const description=form.elements['expense-description'].value;const amount=parseFloat(form.elements['expense-amount'].value);const categoryId=form.elements['expense-category'].value;if(!description.trim()||isNaN(amount)||amount<=0||!categoryId){this.showNotification('Please fill all fields correctly.','error');return}const newExpense={id:`txn_${Date.now()}`,type:'expense',description:description.trim(),amount,categoryId,date:new Date().toISOString()};employee.transactions.push(newExpense);this.saveState();this.render();this.showNotification('Expense recorded successfully!','success');form.reset()},
        async handleGenerateInvoice(e){e.preventDefault();if(!this.pdfShiftApiKey||this.pdfShiftApiKey==='YOUR_PDFSHIFT_API_KEY'){this.showNotification('PDFShift API Key not configured.','error');return}const storeId=document.getElementById('invoice-store').value;const startDate=document.getElementById('invoice-start-date').value;const endDate=document.getElementById('invoice-end-date').value;const store=this.getStore(storeId);if(!store||!startDate||!endDate){this.showNotification('Please select a store and date range.','error');return}const salesInPeriod=[];let total=0;this.state.employees.forEach(emp=>{emp.transactions.forEach(t=>{if(t.type==='sale'&&t.storeId===storeId){const saleDate=t.date.split('T')[0];if(saleDate>=startDate&&saleDate<=endDate){salesInPeriod.push(t);total+=t.amount}}})});if(salesInPeriod.length===0){this.showNotification('No sales found for this store in the selected period.','error');return}const invoiceHTML=this.generateInvoiceHtml(store,salesInPeriod,total,startDate,endDate);this.showNotification('Generating PDF...');try{const response=await fetch('https://api.pdfshift.io/v3/convert/pdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({source:invoiceHTML,auth:this.pdfShiftApiKey,landscape:false,use_print:true})});if(response.ok){const blob=await response.blob();const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.style.display='none';a.href=url;a.download=`Invoice_${store.name}_${startDate}_${endDate}.pdf`;document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);this.showNotification('PDF Invoice downloaded!','success')}else{const error=await response.json();throw new Error(error.error||'PDF generation failed')}}catch(error){console.error('PDF Generation Error:',error);this.showNotification(`Error: ${error.message}`,'error')}},
        generateInvoiceHtml(store,sales,total,startDate,endDate){const salesRows=sales.map(sale=>{const product=this.getProduct(sale.productId);const employee=this.state.employees.find(e=>e.transactions.some(t=>t.id===sale.id));return`<tr><td>${new Date(sale.date).toLocaleDateString()}</td><td>${employee?.name||'N/A'}</td><td>${product?.name||'N/A'}</td><td>${sale.quantity}</td><td>$${product?.price.toFixed(2)}</td><td>$${sale.discount.toFixed(2)}</td><td>$${sale.amount.toFixed(2)}</td></tr>`}).join('');return`<html><head><style>body{font-family:sans-serif;color:#333}table{width:100%;border-collapse:collapse}th,td{border:1px solid #ddd;padding:8px;text-align:left}th{background-color:#f2f2f2}h1{color:#89b4fa}</style></head><body><h1>Invoice for ${store.name}</h1><p><b>Period:</b> ${startDate} to ${endDate}</p><table><thead><tr><th>Date</th><th>Sold By</th><th>Product</th><th>Qty</th><th>Unit Price</th><th>Discount</th><th>Total</th></tr></thead><tbody>${salesRows}</tbody></table><h2 style="text-align:right;margin-top:20px;">Total Due: $${total.toFixed(2)}</h2></body></html>`},
        async generateAIPlan(){const employeeId=document.getElementById('ai-employee-select').value;const employee=this.getEmployee(employeeId);if(!employee)return;const btn=document.getElementById('generate-plan-btn');const btnText=document.getElementById('generate-plan-text');const loader=document.getElementById('generate-plan-loader');const outputDiv=document.getElementById('ai-plan-output');btn.disabled=true;btnText.textContent='Generating...';loader.classList.remove('hidden');outputDiv.innerHTML='<p class="text-light-text-secondary dark:text-dark-text-secondary">Thinking...</p>';const revenue=employee.transactions.filter(t=>t.type==='sale').reduce((sum,t)=>sum+t.amount,0);const expenses=employee.transactions.filter(t=>t.type==='expense').reduce((sum,t)=>sum+t.amount,0);const profit=revenue-expenses;const transactionsSummary=employee.transactions.slice(-10).map(t=>`${t.type}: $${t.amount.toFixed(2)}`).join(', ');try{const aiResponse=await this.mockGeminiAPI(employee.name,revenue,expenses,profit,transactionsSummary);outputDiv.innerHTML=this.simpleMarkdownToHtml(aiResponse)}catch(error){outputDiv.innerHTML=`<p class="text-accent-red">An error occurred while generating the plan.</p>`}finally{btn.disabled=false;btnText.textContent='Generate Plan';loader.classList.add('hidden')}},
        async mockGeminiAPI(name,revenue,expenses,profit,transactions){await new Promise(res=>setTimeout(res,1500));let advice=`### Action Plan for ${name}\n\n**Analysis:**\n- **Revenue:** $${revenue.toFixed(2)}\n- **Expenses:** $${expenses.toFixed(2)}\n- **Profit:** $${profit.toFixed(2)}\n\n`;if(profit>0&&revenue>0){advice+=`**Recommendation:**\nGreat work! ${name} is profitable. To increase profits, focus on two areas:\n1. **Upsell High-Performing Products:** Analyze which products generate the most revenue and ensure ${name} has ample stock.\n2. **Optimize Minor Expenses:** Look at the expense categories. Can any recurring costs be reduced?`}else if(revenue>0){advice+=`**Recommendation:**\n${name} is generating revenue, but expenses are too high. Immediate action is needed:\n1. **Review All Expenses:** Scrutinize every expense. Is it essential? Can a cheaper alternative be found?\n2. **Increase Sales Volume:** Focus on increasing the number of sales to cover fixed costs. Consider small, targeted discounts.`}else{advice+=`**Recommendation:**\nThere is currently no revenue data for ${name}. The primary focus should be on initiating sales activity.\n1. **First Sale Focus:** Prioritize training and resources to help ${name} make their first sales.\n2. **Market Engagement:** Ensure ${name} is actively engaging with potential stores and customers.`}return advice},
        simpleMarkdownToHtml(md){return md.replace(/^### (.*$)/gim,'<h3 class="font-bold text-lg mb-2">$1</h3>').replace(/^## (.*$)/gim,'<h2 class="font-bold text-xl mb-3">$1</h2>').replace(/^# (.*$)/gim,'<h1 class="font-bold text-2xl mb-4">$1</h1>').replace(/\*\*(.*)\*\*/gim,'<strong>$1</strong>').replace(/\*(.*)\*/gim,'<em>$1</em>').replace(/\n\s*-\s/g,'<br>- ').replace(/\n/g,'<br>')}
    };

    window.app = app;
    
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `.modal-input { width: 100%; background-color: ${tailwind.config.theme.extend.colors['light-bg']}; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem 0.75rem; } .dark .modal-input { background-color: ${tailwind.config.theme.extend.colors['dark-bg']}; border-color: #4b5563; } .modal-submit-button { width: 100%; background-color: ${tailwind.config.theme.extend.colors.primary}; color: black; font-weight: bold; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.2s; } .modal-submit-button:hover { background-color: ${tailwind.config.theme.extend.colors['primary-hover']}; } .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: ${tailwind.config.theme.extend.colors['light-text-secondary']}; } .dark .form-label { color: ${tailwind.config.theme.extend.colors['dark-text-secondary']}; } .form-input { margin-top: 0.25rem; display: block; width: 100%; background-color: ${tailwind.config.theme.extend.colors['light-bg']}; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.5rem 0.75rem; outline: none; } .dark .form-input { background-color: ${tailwind.config.theme.extend.colors['dark-bg']}; border-color: #4b5563; } .form-input:focus { ring: 2px; border-color: ${tailwind.config.theme.extend.colors.primary}; box-shadow: 0 0 0 2px ${tailwind.config.theme.extend.colors.primary}; } .table-header { padding: 0.75rem 1.5rem; text-align: left; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: ${tailwind.config.theme.extend.colors['light-text-secondary']}; } .dark .table-header { color: ${tailwind.config.theme.extend.colors['dark-text-secondary']}; }`;
    document.head.appendChild(styleSheet);
    
    app.init();
});
</script>

</body>
</html>
