<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Reader - Modern Islamic App</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Default theme - Light */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-accent: #0f766e;
            --border-color: #e2e8f0;
            --accent-primary: #14b8a6;
            --accent-secondary: #0d9488;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
            --gradient-primary: linear-gradient(135deg, #14b8a6, #0f766e);
            --gradient-bg: linear-gradient(135deg, #f8fafc, #e2e8f0);
        }

        /* Theme variations */
        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-accent: #5eead4;
            --border-color: #475569;
            --accent-primary: #5eead4;
            --accent-secondary: #2dd4bf;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.4);
            --gradient-primary: linear-gradient(135deg, #5eead4, #14b8a6);
            --gradient-bg: linear-gradient(135deg, #0f172a, #1e293b);
        }

        [data-theme="sepia"] {
            --bg-primary: #fef7ed;
            --bg-secondary: #fed7aa;
            --bg-tertiary: #fdba74;
            --text-primary: #9a3412;
            --text-secondary: #c2410c;
            --text-accent: #ea580c;
            --border-color: #fed7aa;
            --accent-primary: #ea580c;
            --accent-secondary: #dc2626;
            --shadow-sm: 0 1px 3px rgba(154, 52, 18, 0.1);
            --shadow-md: 0 4px 12px rgba(154, 52, 18, 0.15);
            --shadow-lg: 0 10px 25px rgba(154, 52, 18, 0.2);
            --gradient-primary: linear-gradient(135deg, #ea580c, #dc2626);
            --gradient-bg: linear-gradient(135deg, #fef7ed, #fed7aa);
        }

        [data-theme="midnight"] {
            --bg-primary: #1e1b4b;
            --bg-secondary: #312e81;
            --bg-tertiary: #4338ca;
            --text-primary: #e0e7ff;
            --text-secondary: #c7d2fe;
            --text-accent: #a5b4fc;
            --border-color: #4338ca;
            --accent-primary: #6366f1;
            --accent-secondary: #4f46e5;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #6366f1, #4f46e5);
            --gradient-bg: linear-gradient(135deg, #1e1b4b, #312e81);
        }

        [data-theme="emerald"] {
            --bg-primary: #ecfdf5;
            --bg-secondary: #d1fae5;
            --bg-tertiary: #a7f3d0;
            --text-primary: #064e3b;
            --text-secondary: #047857;
            --text-accent: #059669;
            --border-color: #a7f3d0;
            --accent-primary: #10b981;
            --accent-secondary: #059669;
            --shadow-sm: 0 1px 3px rgba(6, 78, 59, 0.1);
            --shadow-md: 0 4px 12px rgba(6, 78, 59, 0.15);
            --shadow-lg: 0 10px 25px rgba(6, 78, 59, 0.2);
            --gradient-primary: linear-gradient(135deg, #10b981, #059669);
            --gradient-bg: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }

        [data-theme="rose"] {
            --bg-primary: #fdf2f8;
            --bg-secondary: #fce7f3;
            --bg-tertiary: #fbcfe8;
            --text-primary: #881337;
            --text-secondary: #be185d;
            --text-accent: #e11d48;
            --border-color: #fbcfe8;
            --accent-primary: #f43f5e;
            --accent-secondary: #e11d48;
            --shadow-sm: 0 1px 3px rgba(136, 19, 55, 0.1);
            --shadow-md: 0 4px 12px rgba(136, 19, 55, 0.15);
            --shadow-lg: 0 10px 25px rgba(136, 19, 55, 0.2);
            --gradient-primary: linear-gradient(135deg, #f43f5e, #e11d48);
            --gradient-bg: linear-gradient(135deg, #fdf2f8, #fce7f3);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--gradient-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .header {
            background: rgba(15, 23, 42, 0.9);
        }

        .header-content {
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-accent);
            text-decoration: none;
        }

        .logo-icon {
            width: 2rem;
            height: 2rem;
            background: var(--gradient-primary);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-icon {
            padding: 0.75rem;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            box-shadow: 0 4px 20px rgba(20, 184, 166, 0.4);
        }

        /* Search */
        .search-section {
            padding: 2rem 0;
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Surah Grid */
        .surah-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            padding: 2rem 0;
        }

        .surah-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .surah-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .surah-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-primary);
        }

        .surah-card:hover::before {
            transform: scaleX(1);
        }

        .surah-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .surah-number {
            width: 3rem;
            height: 3rem;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .surah-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-accent);
            text-align: right;
        }

        .surah-info {
            margin-top: 0.5rem;
        }

        .surah-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .surah-meta {
            color: var(--text-secondary);
            font-size: 0.875rem;
            display: flex;
            gap: 1rem;
        }

        .surah-translation {
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 0.5rem;
        }

        /* Verse View */
        .verse-view {
            padding: 2rem 0;
        }

        .verse-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--bg-primary);
            border-radius: 1rem;
            border: 1px solid var(--border-color);
        }

        .verse-surah-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-accent);
            margin-bottom: 0.5rem;
        }

        .verse-surah-arabic {
            font-family: 'Amiri', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .verse-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .verse-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .verse-card.playing {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.2);
        }

        .verse-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            background: var(--gradient-primary);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .verse-arabic {
            font-family: 'Amiri', serif;
            font-size: 2rem;
            line-height: 3.5rem;
            text-align: right;
            direction: rtl;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            word-spacing: 0.5rem;
        }

        .arabic-word {
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s ease;
            position: relative;
        }

        .arabic-word:hover {
            background: rgba(20, 184, 166, 0.1);
            color: var(--accent-primary);
        }

        .arabic-word.highlighted {
            background: rgba(20, 184, 166, 0.2);
            color: var(--accent-primary);
        }

        .verse-translation {
            font-family: 'Inter', sans-serif;
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .verse-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.2s ease;
            max-width: 200px;
            word-wrap: break-word;
        }

        .tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Modals */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-accent);
        }

        .close-btn {
            width: 2rem;
            height: 2rem;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: var(--accent-primary);
            color: white;
        }

        /* Theme Grid */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .theme-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .theme-option:hover {
            transform: translateY(-2px);
        }

        .theme-option.active {
            border-color: var(--accent-primary);
            background: rgba(20, 184, 166, 0.1);
        }

        .theme-preview {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: var(--shadow-sm);
        }

        .theme-name {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Reciter List */
        .reciter-list {
            space-y: 0.75rem;
        }

        .reciter-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .reciter-option:hover {
            background: var(--bg-tertiary);
        }

        .reciter-option input {
            width: 1.25rem;
            height: 1.25rem;
        }

        /* AI Chat */
        .chat-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--bg-secondary);
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            max-width: 80%;
        }

        .message.user {
            background: var(--gradient-primary);
            color: white;
            margin-left: auto;
        }

        .message.assistant {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
        }

        .chat-input {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        /* Audio Player */
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .play-btn {
            width: 3rem;
            height: 3rem;
            border: none;
            background: var(--gradient-primary);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .play-btn:hover {
            transform: scale(1.05);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .surah-grid {
                grid-template-columns: 1fr;
            }
            
            .verse-arabic {
                font-size: 1.5rem;
                line-height: 2.5rem;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
        }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 3rem;
            height: 3rem;
            background: var(--gradient-primary);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 50;
        }

        .back-btn:hover {
            transform: scale(1.1);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="#" class="logo" id="logo">
                    <div class="logo-icon">ðŸ“–</div>
                    <span>Quran Reader</span>
                </a>
                <div class="header-actions">
                    <button class="btn btn-icon" id="aiBtn" title="AI Assistant">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z"/>
                        </svg>
                    </button>
                    <button class="btn btn-icon" id="settingsBtn" title="Settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 15.5A3.5 3.5 0 0 1 8.5 12A3.5 3.5 0 0 1 12 8.5A3.5 3.5 0 0 1 15.5 12A3.5 3.5 0 0 1 12 15.5M19.43 12.98C19.47 12.66 19.5 12.34 19.5 12C19.5 11.66 19.47 11.34 19.43 11.02L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.97 19.05 5.05L16.56 6.05C16.04 5.65 15.48 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.52 5.32 7.96 5.66 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11.02C4.53 11.34 4.5 11.67 4.5 12C4.5 12.33 4.53 12.66 4.57 12.98L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.95C7.96 18.35 8.52 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.48 18.68 16.04 18.34 16.56 17.95L19.05 18.95C19.27 19.04 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.98Z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Main Content -->
        <main id="mainContent">
            <!-- Surah List View -->
            <div id="surahListView">
                <!-- Search Section -->
                <section class="search-section">
                    <div class="search-container">
                        <div style="position: relative;">
                            <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14z"/>
                            </svg>
                            <input type="text" class="search-input" id="searchInput" placeholder="Search Surahs...">
                        </div>
                    </div>
                </section>

                <!-- Surah Grid -->
                <div class="surah-grid" id="surahGrid">
                    <!-- Surahs will be populated here -->
                </div>
            </div>

            <!-- Verse View -->
            <div id="verseView" class="verse-view hidden">
                <div class="verse-header" id="verseHeader">
                    <!-- Surah info will be populated here -->
                </div>
                <div id="versesContainer">
                    <!-- Verses will be populated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Back Button -->
    <button class="back-btn hidden" id="backBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
    </button>

    <!-- Modals -->
    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Settings</h2>
                <button class="close-btn" id="closeSettings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"/>
                    </svg>
                </button>
            </div>
            
            <h3 style="margin-bottom: 1rem; color: var(--text-accent);">Theme</h3>
            <div class="theme-grid" id="themeGrid">
                <!-- Theme options will be populated here -->
            </div>

            <h3 style="margin: 2rem 0 1rem; color: var(--text-accent);">Reciter</h3>
            <div class="reciter-list" id="reciterList">
                <!-- Reciter options will be populated here -->
            </div>
        </div>
    </div>

    <!-- AI Modal -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">AI Assistant</h2>
                <button class="close-btn" id="closeAi">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"/>
                    </svg>
                </button>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <div class="message assistant">
                    <strong>AI Assistant:</strong> Assalamu Alaikum! I'm here to help you with questions about Islam and the Quran. How can I assist you today?
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Ask a question..." />
                <button class="btn btn-primary" id="sendMessage">Send</button>
            </div>
        </div>
    </div>

    <!-- Info Modal -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="infoTitle">Surah Information</h2>
                <button class="close-btn" id="closeInfo">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z"/>
                    </svg>
                </button>
            </div>
            <div id="infoContent">
                <!-- Info content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Audio Element -->
    <audio id="audioPlayer"></audio>

    <script>
        // App State
        const state = {
            currentTheme: 'light',
            currentReciter: 7,
            currentSurah: null,
            currentVerses: [],
            playingVerse: null,
            currentSurahInfo: null,
            searchTerm: ''
        };

        // API Configuration
        const API_BASE = 'https://api.quran.com/api/v4';
        const RECITERS = [
            { id: 7, name: 'Mishary Rashid Alafasy' },
            { id: 1, name: 'Abdul Basit Abdus Samad' },
            { id: 4, name: 'Abdur-Rahman as-Sudais' },
            { id: 2, name: 'Maher Al Muaiqly' },
            { id: 11, name: 'Yasser Ad-Dussary' }
        ];

        const THEMES = [
            { key: 'light', name: 'Light', color: '#14b8a6' },
            { key: 'dark', name: 'Dark', color: '#1e293b' },
            { key: 'sepia', name: 'Sepia', color: '#ea580c' },
            { key: 'midnight', name: 'Midnight', color: '#4338ca' },
            { key: 'emerald', name: 'Emerald', color: '#10b981' },
            { key: 'rose', name: 'Rose', color: '#f43f5e' }
        ];

        // Surah List (embedded for performance)
        const SURAHS = [
            {"id":1,"name":"Ø§Ù„ÙØ§ØªØ­Ø©","transliteration":"Al-Fatihah","translation":"The Opener","type":"Meccan","total_verses":7},
            {"id":2,"name":"Ø§Ù„Ø¨Ù‚Ø±Ø©","transliteration":"Al-Baqarah","translation":"The Cow","type":"Medinan","total_verses":286},
            {"id":3,"name":"Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","transliteration":"Aal-E-Imran","translation":"The Family of Imran","type":"Medinan","total_verses":200},
            {"id":4,"name":"Ø§Ù„Ù†Ø³Ø§Ø¡","transliteration":"An-Nisa","translation":"The Women","type":"Medinan","total_verses":176},
            {"id":5,"name":"Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","transliteration":"Al-Ma'idah","translation":"The Table Spread","type":"Medinan","total_verses":120},
            {"id":6,"name":"Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","transliteration":"Al-An'am","translation":"The Cattle","type":"Meccan","total_verses":165},
            {"id":7,"name":"Ø§Ù„Ø£Ø¹Ø±Ø§Ù","transliteration":"Al-A'raf","translation":"The Heights","type":"Meccan","total_verses":206},
            {"id":8,"name":"Ø§Ù„Ø£Ù†ÙØ§Ù„","transliteration":"Al-Anfal","translation":"The Spoils of War","type":"Medinan","total_verses":75},
            {"id":9,"name":"Ø§Ù„ØªÙˆØ¨Ø©","transliteration":"At-Tawbah","translation":"The Repentance","type":"Medinan","total_verses":129},
            {"id":10,"name":"ÙŠÙˆÙ†Ø³","transliteration":"Yunus","translation":"Jonah","type":"Meccan","total_verses":109},
            {"id":11,"name":"Ù‡ÙˆØ¯","transliteration":"Hud","translation":"Hud","type":"Meccan","total_verses":123},
            {"id":12,"name":"ÙŠÙˆØ³Ù","transliteration":"Yusuf","translation":"Joseph","type":"Meccan","total_verses":111},
            {"id":13,"name":"Ø§Ù„Ø±Ø¹Ø¯","transliteration":"Ar-Ra'd","translation":"The Thunder","type":"Medinan","total_verses":43},
            {"id":14,"name":"Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…","transliteration":"Ibrahim","translation":"Abraham","type":"Meccan","total_verses":52},
            {"id":15,"name":"Ø§Ù„Ø­Ø¬Ø±","transliteration":"Al-Hijr","translation":"The Rocky Tract","type":"Meccan","total_verses":99},
            {"id":16,"name":"Ø§Ù„Ù†Ø­Ù„","transliteration":"An-Nahl","translation":"The Bee","type":"Meccan","total_verses":128},
            {"id":17,"name":"Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","transliteration":"Al-Isra","translation":"The Night Journey","type":"Meccan","total_verses":111},
            {"id":18,"name":"Ø§Ù„ÙƒÙ‡Ù","transliteration":"Al-Kahf","translation":"The Cave","type":"Meccan","total_verses":110},
            {"id":19,"name":"Ù…Ø±ÙŠÙ…","transliteration":"Maryam","translation":"Mary","type":"Meccan","total_verses":98},
            {"id":20,"name":"Ø·Ù‡","transliteration":"Taha","translation":"Ta-Ha","type":"Meccan","total_verses":135},
            {"id":21,"name":"Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","transliteration":"Al-Anbiya","translation":"The Prophets","type":"Meccan","total_verses":112},
            {"id":22,"name":"Ø§Ù„Ø­Ø¬","transliteration":"Al-Hajj","translation":"The Pilgrimage","type":"Medinan","total_verses":78},
            {"id":23,"name":"Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","transliteration":"Al-Mu'minun","translation":"The Believers","type":"Meccan","total_verses":118},
            {"id":24,"name":"Ø§Ù„Ù†ÙˆØ±","transliteration":"An-Nur","translation":"The Light","type":"Medinan","total_verses":64},
            {"id":25,"name":"Ø§Ù„ÙØ±Ù‚Ø§Ù†","transliteration":"Al-Furqan","translation":"The Criterion","type":"Meccan","total_verses":77},
            {"id":26,"name":"Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","transliteration":"Ash-Shu'ara","translation":"The Poets","type":"Meccan","total_verses":227},
            {"id":27,"name":"Ø§Ù„Ù†Ù…Ù„","transliteration":"An-Naml","translation":"The Ant","type":"Meccan","total_verses":93},
            {"id":28,"name":"Ø§Ù„Ù‚ØµØµ","transliteration":"Al-Qasas","translation":"The Stories","type":"Meccan","total_verses":88},
            {"id":29,"name":"Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","transliteration":"Al-'Ankabut","translation":"The Spider","type":"Meccan","total_verses":69},
            {"id":30,"name":"Ø§Ù„Ø±ÙˆÙ…","transliteration":"Ar-Rum","translation":"The Romans","type":"Meccan","total_verses":60},
            {"id":31,"name":"Ù„Ù‚Ù…Ø§Ù†","transliteration":"Luqman","translation":"Luqman","type":"Meccan","total_verses":34},
            {"id":32,"name":"Ø§Ù„Ø³Ø¬Ø¯Ø©","transliteration":"As-Sajdah","translation":"The Prostration","type":"Meccan","total_verses":30},
            {"id":33,"name":"Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","transliteration":"Al-Ahzab","translation":"The Combined Forces","type":"Medinan","total_verses":73},
            {"id":34,"name":"Ø³Ø¨Ø¥","transliteration":"Saba","translation":"Sheba","type":"Meccan","total_verses":54},
            {"id":35,"name":"ÙØ§Ø·Ø±","transliteration":"Fatir","translation":"Originator","type":"Meccan","total_verses":45},
            {"id":36,"name":"ÙŠØ³","transliteration":"Ya-Sin","translation":"Ya Sin","type":"Meccan","total_verses":83},
            {"id":37,"name":"Ø§Ù„ØµØ§ÙØ§Øª","transliteration":"As-Saffat","translation":"Those who set the Ranks","type":"Meccan","total_verses":182},
            {"id":38,"name":"Øµ","transliteration":"Sad","translation":"The Letter 'Saad'","type":"Meccan","total_verses":38},
            {"id":39,"name":"Ø§Ù„Ø²Ù…Ø±","transliteration":"Az-Zumar","translation":"The Troops","type":"Meccan","total_verses":75},
            {"id":40,"name":"ØºØ§ÙØ±","transliteration":"Ghafir","translation":"The Forgiver","type":"Meccan","total_verses":85},
            {"id":41,"name":"ÙØµÙ„Øª","transliteration":"Fussilat","translation":"Explained in Detail","type":"Meccan","total_verses":54},
            {"id":42,"name":"Ø§Ù„Ø´ÙˆØ±Ù‰","transliteration":"Ash-Shuraa","translation":"The Consultation","type":"Meccan","total_verses":53},
            {"id":43,"name":"Ø§Ù„Ø²Ø®Ø±Ù","transliteration":"Az-Zukhruf","translation":"The Ornaments of Gold","type":"Meccan","total_verses":89},
            {"id":44,"name":"Ø§Ù„Ø¯Ø®Ø§Ù†","transliteration":"Ad-Dukhan","translation":"The Smoke","type":"Meccan","total_verses":59},
            {"id":45,"name":"Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","transliteration":"Al-Jaathiya","translation":"The Crouching","type":"Meccan","total_verses":37},
            {"id":46,"name":"Ø§Ù„Ø£Ø­Ù‚Ø§Ù","transliteration":"Al-Ahqaf","translation":"The Wind-Curved Sandhills","type":"Meccan","total_verses":35},
            {"id":47,"name":"Ù…Ø­Ù…Ø¯","transliteration":"Muhammad","translation":"Muhammad","type":"Medinan","total_verses":38},
            {"id":48,"name":"Ø§Ù„ÙØªØ­","transliteration":"Al-Fath","translation":"The Victory","type":"Medinan","total_verses":29},
            {"id":49,"name":"Ø§Ù„Ø­Ø¬Ø±Ø§Øª","transliteration":"Al-Hujraat","translation":"The Rooms","type":"Medinan","total_verses":18},
            {"id":50,"name":"Ù‚","transliteration":"Qaaf","translation":"The Letter 'Qaf'","type":"Meccan","total_verses":45},
            {"id":51,"name":"Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","transliteration":"Adh-Dhaariyat","translation":"The Winnowing Winds","type":"Meccan","total_verses":60},
            {"id":52,"name":"Ø§Ù„Ø·ÙˆØ±","transliteration":"At-Tur","translation":"The Mount","type":"Meccan","total_verses":49},
            {"id":53,"name":"Ø§Ù„Ù†Ø¬Ù…","transliteration":"An-Najm","translation":"The Star","type":"Meccan","total_verses":62},
            {"id":54,"name":"Ø§Ù„Ù‚Ù…Ø±","transliteration":"Al-Qamar","translation":"The Moon","type":"Meccan","total_verses":55},
            {"id":55,"name":"Ø§Ù„Ø±Ø­Ù…Ù†","transliteration":"Ar-Rahman","translation":"The Beneficent","type":"Meccan","total_verses":78},
            {"id":56,"name":"Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","transliteration":"Al-Waaqia","translation":"The Inevitable","type":"Meccan","total_verses":96},
            {"id":57,"name":"Ø§Ù„Ø­Ø¯ÙŠØ¯","transliteration":"Al-Hadid","translation":"The Iron","type":"Medinan","total_verses":29},
            {"id":58,"name":"Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","transliteration":"Al-Mujaadila","translation":"The Pleading Woman","type":"Medinan","total_verses":22},
            {"id":59,"name":"Ø§Ù„Ø­Ø´Ø±","transliteration":"Al-Hashr","translation":"The Exile","type":"Medinan","total_verses":24},
            {"id":60,"name":"Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","transliteration":"Al-Mumtahana","translation":"She that is to be examined","type":"Medinan","total_verses":13},
            {"id":61,"name":"Ø§Ù„ØµÙ","transliteration":"As-Saff","translation":"The Ranks","type":"Medinan","total_verses":14},
            {"id":62,"name":"Ø§Ù„Ø¬Ù…Ø¹Ø©","transliteration":"Al-Jumu'a","translation":"The Congregation, Friday","type":"Medinan","total_verses":11},
            {"id":63,"name":"Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†","transliteration":"Al-Munaafiqoon","translation":"The Hypocrites","type":"Medinan","total_verses":11},
            {"id":64,"name":"Ø§Ù„ØªØºØ§Ø¨Ù†","transliteration":"At-Taghaabun","translation":"The Mutual Disillusion","type":"Medinan","total_verses":18},
            {"id":65,"name":"Ø§Ù„Ø·Ù„Ø§Ù‚","transliteration":"At-Talaaq","translation":"The Divorce","type":"Medinan","total_verses":12},
            {"id":66,"name":"Ø§Ù„ØªØ­Ø±ÙŠÙ…","transliteration":"At-Tahrim","translation":"The Prohibition","type":"Medinan","total_verses":12},
            {"id":67,"name":"Ø§Ù„Ù…Ù„Ùƒ","transliteration":"Al-Mulk","translation":"The Sovereignty","type":"Meccan","total_verses":30},
            {"id":68,"name":"Ø§Ù„Ù‚Ù„Ù…","transliteration":"Al-Qalam","translation":"The Pen","type":"Meccan","total_verses":52},
            {"id":69,"name":"Ø§Ù„Ø­Ø§Ù‚Ø©","transliteration":"Al-Haaqqa","translation":"The Reality","type":"Meccan","total_verses":52},
            {"id":70,"name":"Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","transliteration":"Al-Ma'aarij","translation":"The Ascending Stairways","type":"Meccan","total_verses":44},
            {"id":71,"name":"Ù†ÙˆØ­","transliteration":"Nooh","translation":"Noah","type":"Meccan","total_verses":28},
            {"id":72,"name":"Ø§Ù„Ø¬Ù†","transliteration":"Al-Jinn","translation":"The Jinn","type":"Meccan","total_verses":28},
            {"id":73,"name":"Ø§Ù„Ù…Ø²Ù…Ù„","transliteration":"Al-Muzzammil","translation":"The Enshrouded One","type":"Meccan","total_verses":20},
            {"id":74,"name":"Ø§Ù„Ù…Ø¯Ø«Ø±","transliteration":"Al-Muddaththir","translation":"The Cloaked One","type":"Meccan","total_verses":56},
            {"id":75,"name":"Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","transliteration":"Al-Qiyaama","translation":"The Resurrection","type":"Meccan","total_verses":40},
            {"id":76,"name":"Ø§Ù„Ø§Ù†Ø³Ø§Ù†","transliteration":"Al-Insaan","translation":"The Man","type":"Medinan","total_verses":31},
            {"id":77,"name":"Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","transliteration":"Al-Mursalaat","translation":"The Emissaries","type":"Meccan","total_verses":50},
            {"id":78,"name":"Ø§Ù„Ù†Ø¨Ø¥","transliteration":"An-Naba","translation":"The Tidings","type":"Meccan","total_verses":40},
            {"id":79,"name":"Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","transliteration":"An-Naazi'aat","translation":"Those who drag forth","type":"Meccan","total_verses":46},
            {"id":80,"name":"Ø¹Ø¨Ø³","transliteration":"Abasa","translation":"He Frowned","type":"Meccan","total_verses":42},
            {"id":81,"name":"Ø§Ù„ØªÙƒÙˆÙŠØ±","transliteration":"At-Takwir","translation":"The Overthrowing","type":"Meccan","total_verses":29},
            {"id":82,"name":"Ø§Ù„Ø¥Ù†ÙØ·Ø§Ø±","transliteration":"Al-Infitaar","translation":"The Cleaving","type":"Meccan","total_verses":19},
            {"id":83,"name":"Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","transliteration":"Al-Mutaffifin","translation":"The Defrauding","type":"Meccan","total_verses":36},
            {"id":84,"name":"Ø§Ù„Ø¥Ù†Ø´Ù‚Ø§Ù‚","transliteration":"Al-Inshiqaaq","translation":"The Splitting Open","type":"Meccan","total_verses":25},
            {"id":85,"name":"Ø§Ù„Ø¨Ø±ÙˆØ¬","transliteration":"Al-Burooj","translation":"The Mansions of the Stars","type":"Meccan","total_verses":22},
            {"id":86,"name":"Ø§Ù„Ø·Ø§Ø±Ù‚","transliteration":"At-Taariq","translation":"The Morning Star","type":"Meccan","total_verses":17},
            {"id":87,"name":"Ø§Ù„Ø£Ø¹Ù„Ù‰","transliteration":"Al-A'laa","translation":"The Most High","type":"Meccan","total_verses":19},
            {"id":88,"name":"Ø§Ù„ØºØ§Ø´ÙŠØ©","transliteration":"Al-Ghaashiya","translation":"The Overwhelming","type":"Meccan","total_verses":26},
            {"id":89,"name":"Ø§Ù„ÙØ¬Ø±","transliteration":"Al-Fajr","translation":"The Dawn","type":"Meccan","total_verses":30},
            {"id":90,"name":"Ø§Ù„Ø¨Ù„Ø¯","transliteration":"Al-Balad","translation":"The City","type":"Meccan","total_verses":20},
            {"id":91,"name":"Ø§Ù„Ø´Ù…Ø³","transliteration":"Ash-Shams","translation":"The Sun","type":"Meccan","total_verses":15},
            {"id":92,"name":"Ø§Ù„Ù„ÙŠÙ„","transliteration":"Al-Lail","translation":"The Night","type":"Meccan","total_verses":21},
            {"id":93,"name":"Ø§Ù„Ø¶Ø­Ù‰","transliteration":"Ad-Duhaa","translation":"The Morning Hours","type":"Meccan","total_verses":11},
            {"id":94,"name":"Ø§Ù„Ø´Ø±Ø­","transliteration":"Ash-Sharh","translation":"The Relief","type":"Meccan","total_verses":8},
            {"id":95,"name":"Ø§Ù„ØªÙŠÙ†","transliteration":"At-Tin","translation":"The Fig","type":"Meccan","total_verses":8},
            {"id":96,"name":"Ø§Ù„Ø¹Ù„Ù‚","transliteration":"Al-Alaq","translation":"The Clot","type":"Meccan","total_verses":19},
            {"id":97,"name":"Ø§Ù„Ù‚Ø¯Ø±","transliteration":"Al-Qadr","translation":"The Power, Fate","type":"Meccan","total_verses":5},
            {"id":98,"name":"Ø§Ù„Ø¨ÙŠÙ†Ø©","transliteration":"Al-Bayyina","translation":"The Evidence","type":"Medinan","total_verses":8},
            {"id":99,"name":"Ø§Ù„Ø²Ù„Ø²Ù„Ø©","transliteration":"Az-Zalzala","translation":"The Earthquake","type":"Medinan","total_verses":8},
            {"id":100,"name":"Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","transliteration":"Al-Aadiyaat","translation":"The Courser","type":"Meccan","total_verses":11},
            {"id":101,"name":"Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","transliteration":"Al-Qaari'a","translation":"The Calamity","type":"Meccan","total_verses":11},
            {"id":102,"name":"Ø§Ù„ØªÙƒØ§Ø«Ø±","transliteration":"At-Takaathur","translation":"The Rivalry in world increase","type":"Meccan","total_verses":8},
            {"id":103,"name":"Ø§Ù„Ø¹ØµØ±","transliteration":"Al-Asr","translation":"The Declining Day, Epoch","type":"Meccan","total_verses":3},
            {"id":104,"name":"Ø§Ù„Ù‡Ù…Ø²Ø©","transliteration":"Al-Humaza","translation":"The Traducer","type":"Meccan","total_verses":9},
            {"id":105,"name":"Ø§Ù„ÙÙŠÙ„","transliteration":"Al-Fil","translation":"The Elephant","type":"Meccan","total_verses":5},
            {"id":106,"name":"Ù‚Ø±ÙŠØ´","transliteration":"Quraish","translation":"Quraysh","type":"Meccan","total_verses":4},
            {"id":107,"name":"Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","transliteration":"Al-Maa'un","translation":"The Small kindnesses","type":"Meccan","total_verses":7},
            {"id":108,"name":"Ø§Ù„ÙƒÙˆØ«Ø±","transliteration":"Al-Kawthar","translation":"The Abundance","type":"Meccan","total_verses":3},
            {"id":109,"name":"Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","transliteration":"Al-Kaafiroon","translation":"The Disbelievers","type":"Meccan","total_verses":6},
            {"id":110,"name":"Ø§Ù„Ù†ØµØ±","transliteration":"An-Nasr","translation":"The Divine Support","type":"Medinan","total_verses":3},
            {"id":111,"name":"Ø§Ù„Ù…Ø³Ø¯","transliteration":"Al-Masad","translation":"The Palm Fibre","type":"Meccan","total_verses":5},
            {"id":112,"name":"Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","transliteration":"Al-Ikhlaas","translation":"The Sincerity","type":"Meccan","total_verses":4},
            {"id":113,"name":"Ø§Ù„ÙÙ„Ù‚","transliteration":"Al-Falaq","translation":"The Dawn","type":"Meccan","total_verses":5},
            {"id":114,"name":"Ø§Ù„Ù†Ø§Ø³","transliteration":"An-Naas","translation":"Mankind","type":"Meccan","total_verses":6}
        ];

        // DOM Elements
        const elements = {
            surahGrid: document.getElementById('surahGrid'),
            searchInput: document.getElementById('searchInput'),
            surahListView: document.getElementById('surahListView'),
            verseView: document.getElementById('verseView'),
            verseHeader: document.getElementById('verseHeader'),
            versesContainer: document.getElementById('versesContainer'),
            backBtn: document.getElementById('backBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsModal: document.getElementById('settingsModal'),
            closeSettings: document.getElementById('closeSettings'),
            themeGrid: document.getElementById('themeGrid'),
            reciterList: document.getElementById('reciterList'),
            aiBtn: document.getElementById('aiBtn'),
            aiModal: document.getElementById('aiModal'),
            closeAi: document.getElementById('closeAi'),
            chatContainer: document.getElementById('chatContainer'),
            chatInput: document.getElementById('chatInput'),
            sendMessage: document.getElementById('sendMessage'),
            infoModal: document.getElementById('infoModal'),
            closeInfo: document.getElementById('closeInfo'),
            infoTitle: document.getElementById('infoTitle'),
            infoContent: document.getElementById('infoContent'),
            tooltip: document.getElementById('tooltip'),
            audioPlayer: document.getElementById('audioPlayer'),
            logo: document.getElementById('logo')
        };

        // Utility Functions
        const utils = {
            showLoading: (container) => {
                container.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            },
            
            hideTooltip: () => {
                elements.tooltip.classList.remove('show');
            },
            
            showTooltip: (element, text) => {
                elements.tooltip.textContent = text;
                const rect = element.getBoundingClientRect();
                elements.tooltip.style.left = `${rect.left + rect.width / 2}px`;
                elements.tooltip.style.top = `${rect.top - 10}px`;
                elements.tooltip.classList.add('show');
            },
            
            formatArabicText: (words) => {
                return words.map(word => 
                    `<span class="arabic-word" data-translation="${word.translation ? word.translation.text.replace(/<[^>]*>/g, '') : ''}">${word.text_uthmani || word.text}</span>`
                ).join(' ');
            }
        };

        // API Functions
        const api = {
            getVerses: async (surahId) => {
                const url = `${API_BASE}/verses/by_chapter/${surahId}?words=true&word_fields=text_uthmani&translations=20&translation_fields=text&audio=${state.currentReciter}&per_page=300`;
                const response = await fetch(url);
                return response.json();
            },
            
            getSurahInfo: async (surahId) => {
                const url = `${API_BASE}/chapters/${surahId}/info`;
                const response = await fetch(url);
                return response.json();
            }
        };

        // UI Functions
        const ui = {
            renderSurahs: (surahs = SURAHS) => {
                elements.surahGrid.innerHTML = surahs.map(surah => `
                    <div class="surah-card" data-surah-id="${surah.id}">
                        <div class="surah-header">
                            <div class="surah-number">${surah.id}</div>
                            <div class="surah-arabic">${surah.name}</div>
                        </div>
                        <div class="surah-info">
                            <div class="surah-name">${surah.transliteration}</div>
                            <div class="surah-meta">
                                <span>${surah.total_verses} verses</span>
                                <span>${surah.type}</span>
                            </div>
                            <div class="surah-translation">${surah.translation}</div>
                        </div>
                    </div>
                `).join('');
            },

            renderVerses: async (surahId) => {
                const surah = SURAHS.find(s => s.id === parseInt(surahId));
                if (!surah) return;

                state.currentSurah = surah;
                utils.showLoading(elements.versesContainer);
                
                // Show verse view
                elements.surahListView.classList.add('hidden');
                elements.verseView.classList.remove('hidden');
                elements.backBtn.classList.remove('hidden');

                // Update header
                elements.verseHeader.innerHTML = `
                    <div class="verse-surah-name">${surah.transliteration}</div>
                    <div class="verse-surah-arabic">${surah.name}</div>
                    <div class="verse-controls">
                        <button class="btn btn-secondary" id="infoBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                            </svg>
                            Info
                        </button>
                    </div>
                `;

                try {
                    const [versesData, infoData] = await Promise.all([
                        api.getVerses(surahId),
                        api.getSurahInfo(surahId)
                    ]);

                    state.currentVerses = versesData.verses;
                    state.currentSurahInfo = infoData.chapter_info;

                    elements.versesContainer.innerHTML = versesData.verses.map(verse => `
                        <div class="verse-card" data-verse-key="${verse.verse_key}">
                            <div class="verse-number">${verse.verse_number}</div>
                            <div class="verse-arabic" dir="rtl">
                                ${utils.formatArabicText(verse.words)}
                            </div>
                            <div class="verse-translation">
                                ${verse.translations[0]?.text.replace(/<[^>]*>/g, '') || ''}
                            </div>
                            <div class="verse-actions">
                                <button class="play-btn" data-audio-url="${verse.audio.url}" data-verse-key="${verse.verse_key}">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `).join('');

                    // Add info button event listener
                    document.getElementById('infoBtn')?.addEventListener('click', ui.showSurahInfo);

                } catch (error) {
                    console.error('Error loading verses:', error);
                    elements.versesContainer.innerHTML = '<div class="loading">Error loading verses. Please try again.</div>';
                }
            },

            showSurahInfo: () => {
                if (!state.currentSurahInfo) return;
                
                elements.infoTitle.textContent = `About ${state.currentSurah.transliteration}`;
                elements.infoContent.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <strong>Source:</strong> ${state.currentSurahInfo.source || 'Quran.com'}
                    </div>
                    <div style="line-height: 1.8;">
                        ${state.currentSurahInfo.short_text || ''}
                        ${state.currentSurahInfo.text ? '<hr style="margin: 1.5rem 0; border-color: var(--border-color);">' + state.currentSurahInfo.text : ''}
                    </div>
                `;
                elements.infoModal.classList.add('show');
            },

            renderThemes: () => {
                elements.themeGrid.innerHTML = THEMES.map(theme => `
                    <div class="theme-option ${theme.key === state.currentTheme ? 'active' : ''}" data-theme="${theme.key}">
                        <div class="theme-preview" style="background: ${theme.color}"></div>
                        <div class="theme-name">${theme.name}</div>
                    </div>
                `).join('');
            },

            renderReciters: () => {
                elements.reciterList.innerHTML = RECITERS.map(reciter => `
                    <div class="reciter-option">
                        <input type="radio" name="reciter" value="${reciter.id}" ${reciter.id === state.currentReciter ? 'checked' : ''} />
                        <label>${reciter.name}</label>
                    </div>
                `).join('');
            },

            searchSurahs: (term) => {
                const filtered = SURAHS.filter(surah => 
                    surah.transliteration.toLowerCase().includes(term.toLowerCase()) ||
                    surah.name.includes(term) ||
                    surah.translation.toLowerCase().includes(term.toLowerCase())
                );
                ui.renderSurahs(filtered);
            },

            goBack: () => {
                elements.surahListView.classList.remove('hidden');
                elements.verseView.classList.add('hidden');
                elements.backBtn.classList.add('hidden');
                utils.hideTooltip();
                audio.stop();
            }
        };

        // Audio Functions
        const audio = {
            play: (url, verseKey) => {
                audio.stop();
                
                elements.audioPlayer.src = `https://verses.quran.com/${url}`;
                elements.audioPlayer.play();
                
                const verseCard = document.querySelector(`[data-verse-key="${verseKey}"]`);
                const playButton = verseCard.querySelector('.play-btn');
                
                verseCard.classList.add('playing');
                playButton.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                `;
                
                state.playingVerse = { verseKey, playButton, verseCard };
            },

            stop: () => {
                elements.audioPlayer.pause();
                elements.audioPlayer.src = '';
                
                if (state.playingVerse) {
                    state.playingVerse.verseCard.classList.remove('playing');
                    state.playingVerse.playButton.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    `;
                    state.playingVerse = null;
                }
            },

            toggle: (url, verseKey) => {
                if (state.playingVerse && state.playingVerse.verseKey === verseKey) {
                    if (elements.audioPlayer.paused) {
                        elements.audioPlayer.play();
                    } else {
                        elements.audioPlayer.pause();
                    }
                } else {
                    audio.play(url, verseKey);
                }
            }
        };

        // Theme Functions
        const theme = {
            set: (themeName) => {
                document.body.setAttribute('data-theme', themeName);
                state.currentTheme = themeName;
                localStorage.setItem('quran-theme', themeName);
                ui.renderThemes();
            },

            load: () => {
                const saved = localStorage.getItem('quran-theme') || 'light';
                theme.set(saved);
            }
        };

        // Settings Functions
        const settings = {
            save: () => {
                localStorage.setItem('quran-settings', JSON.stringify({
                    theme: state.currentTheme,
                    reciter: state.currentReciter
                }));
            },

            load: () => {
                try {
                    const saved = JSON.parse(localStorage.getItem('quran-settings') || '{}');
                    state.currentReciter = saved.reciter || 7;
                    theme.set(saved.theme || 'light');
                } catch (e) {
                    console.error('Error loading settings:', e);
                }
            }
        };

        // AI Chat Functions
        const ai = {
            addMessage: (sender, message) => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                messageDiv.innerHTML = `<strong>${sender === 'user' ? 'You' : 'AI Assistant'}:</strong> ${message}`;
                elements.chatContainer.appendChild(messageDiv);
                elements.chatContainer.scrollTop = elements.chatContainer.scrollHeight;
            },

            sendMessage: async () => {
                const message = elements.chatInput.value.trim();
                if (!message) return;

                ai.addMessage('user', message);
                elements.chatInput.value = '';

                // Simple AI response (replace with actual AI integration)
                setTimeout(() => {
                    const responses = [
                        "Thank you for your question. I'm here to help with Islamic knowledge and Quranic studies.",
                        "That's an interesting question about Islam. Let me provide you with some guidance based on Islamic teachings.",
                        "I appreciate your interest in learning about Islam. Here's what I can tell you about that topic.",
                        "Based on Islamic principles and Quranic guidance, I can offer the following insights."
                    ];
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    ai.addMessage('assistant', randomResponse);
                }, 1000);
            }
        };

        // Event Listeners
        const events = {
            init: () => {
                // Navigation
                elements.logo.addEventListener('click', (e) => {
                    e.preventDefault();
                    ui.goBack();
                });
                
                elements.backBtn.addEventListener('click', ui.goBack);

                // Search
                elements.searchInput.addEventListener('input', (e) => {
                    ui.searchSurahs(e.target.value);
                });

                // Surah selection
                elements.surahGrid.addEventListener('click', (e) => {
                    const surahCard = e.target.closest('.surah-card');
                    if (surahCard) {
                        const surahId = surahCard.dataset.surahId;
                        ui.renderVerses(surahId);
                    }
                });

                // Verse interactions
                elements.versesContainer.addEventListener('click', (e) => {
                    const playBtn = e.target.closest('.play-btn');
                    if (playBtn) {
                        const audioUrl = playBtn.dataset.audioUrl;
                        const verseKey = playBtn.dataset.verseKey;
                        audio.toggle(audioUrl, verseKey);
                    }
                });

                // Word translation tooltip
                elements.versesContainer.addEventListener('mouseenter', (e) => {
                    if (e.target.classList.contains('arabic-word') && e.target.dataset.translation) {
                        utils.showTooltip(e.target, e.target.dataset.translation);
                    }
                }, true);

                elements.versesContainer.addEventListener('mouseleave', (e) => {
                    if (e.target.classList.contains('arabic-word')) {
                        utils.hideTooltip();
                    }
                }, true);

                // Touch events for mobile
                elements.versesContainer.addEventListener('touchstart', (e) => {
                    if (e.target.classList.contains('arabic-word') && e.target.dataset.translation) {
                        e.target.classList.add('highlighted');
                        utils.showTooltip(e.target, e.target.dataset.translation);
                        setTimeout(() => {
                            e.target.classList.remove('highlighted');
                            utils.hideTooltip();
                        }, 3000);
                    }
                });

                // Settings modal
                elements.settingsBtn.addEventListener('click', () => {
                    elements.settingsModal.classList.add('show');
                });

                elements.closeSettings.addEventListener('click', () => {
                    elements.settingsModal.classList.remove('show');
                });

                // Theme selection
                elements.themeGrid.addEventListener('click', (e) => {
                    const themeOption = e.target.closest('.theme-option');
                    if (themeOption) {
                        theme.set(themeOption.dataset.theme);
                    }
                });

                // Reciter selection
                elements.reciterList.addEventListener('change', (e) => {
                    if (e.target.name === 'reciter') {
                        state.currentReciter = parseInt(e.target.value);
                        settings.save();
                    }
                });

                // AI modal
                elements.aiBtn.addEventListener('click', () => {
                    elements.aiModal.classList.add('show');
                });

                elements.closeAi.addEventListener('click', () => {
                    elements.aiModal.classList.remove('show');
                });

                elements.sendMessage.addEventListener('click', ai.sendMessage);
                elements.chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        ai.sendMessage();
                    }
                });

                // Info modal
                elements.closeInfo.addEventListener('click', () => {
                    elements.infoModal.classList.remove('show');
                });

                // Close modals on backdrop click
                [elements.settingsModal, elements.aiModal, elements.infoModal].forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.remove('show');
                        }
                    });
                });

                // Audio events
                elements.audioPlayer.addEventListener('ended', audio.stop);

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal.show').forEach(modal => {
                            modal.classList.remove('show');
                        });
                        utils.hideTooltip();
                    }
                    
                    if (e.key === 'Backspace' && !elements.verseView.classList.contains('hidden')) {
                        ui.goBack();
                    }
                });
            }
        };

        // App Initialization
        const app = {
            init: () => {
                settings.load();
                ui.renderSurahs();
                ui.renderThemes();
                ui.renderReciters();
                events.init();
                
                console.log('Quran Reader App initialized successfully');
            }
        };

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>
